<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quản trị - QuangHưngShop</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Plus Jakarta Sans', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f4ff',
              100: '#e0e9ff',
              200: '#c7d6fe',
              300: '#a4b8fc',
              400: '#8093f8',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81',
            },
            dark: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
              950: '#020617',
            }
          }
        }
      }
    }
  </script>
  <style>
    * { font-family: 'Plus Jakarta Sans', sans-serif; }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* Sidebar styles - Light & Clean */
    .sidebar-gradient { 
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      border-right: 1px solid #e2e8f0;
    }
    
    .sidebar-item { 
      transition: all 0.2s ease;
      position: relative;
      border-radius: 10px;
    }
    
    .sidebar-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      height: 60%;
      width: 3px;
      background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
      border-radius: 0 4px 4px 0;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .sidebar-item:hover { 
      background: #fef2f2;
    }
    
    .sidebar-item.active { 
      background: #fef2f2;
    }
    
    .sidebar-item.active::before {
      opacity: 1;
    }
    
    .sidebar-item.active .sidebar-icon {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }
    
    .sidebar-item.active .sidebar-icon i {
      color: white !important;
    }
    
    .sidebar-item.active span {
      color: #dc2626;
      font-weight: 600;
    }
    
    .sidebar-item .sidebar-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
    }
    
    /* Stat cards - Clean */
    .stat-card { 
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
    }
    
    .stat-card:hover { 
      transform: translateY(-4px);
      box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.2);
    }
    
    /* Glass effect */
    .glass-effect {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .glass-dark {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Gradient backgrounds - Cleaner colors */
    .gradient-primary { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .gradient-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .gradient-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .gradient-info { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
    .gradient-rose { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }
    .gradient-purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
    
    /* Section animations */
    .section-content { 
      display: none;
      animation: fadeSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .section-content.active { display: block; }
    
    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Button hover effects - Cleaner */
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px -5px rgba(59, 130, 246, 0.4);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    /* Table row hover */
    .table-row-hover:hover {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.05) 0%, transparent 100%);
    }
    
    /* Badge pulse animation */
    .badge-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* Floating animation */
    .float-animation {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    /* Loading shimmer */
    .shimmer {
      background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Modern input focus */
    .modern-input:focus {
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }
    
    /* Notification dot */
    .notification-dot {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 8px;
      height: 8px;
      background: #f43f5e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-slate-100 to-slate-200 min-h-screen">
    <!-- ===== PAGE LOADER - Hiệu ứng loading trang ===== -->
  <div id="page-loader">
    <div class="loader-logo">
      <img src="images/logo.png" alt="QuangHưng Mobile" onerror="this.style.display='none'">
    </div>
    <div class="loader-spinner"></div>
    <div class="loader-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="loader-text">
      <span>Đ</span><span>a</span><span>n</span><span>g</span><span>&nbsp;</span><span>t</span><span>ả</span><span>i</span><span>.</span><span>.</span><span>.</span>
    </div>
    <div class="loader-progress">
      <div class="loader-progress-bar"></div>
    </div>
  </div>

  <div class="flex h-screen overflow-hidden">
    <!-- Light Modern Sidebar -->
    <aside class="hidden lg:flex w-64 sidebar-gradient flex-col flex-shrink-0 shadow-lg relative z-20">
      <!-- Logo Section -->
      <div class="px-5 py-4 border-b border-slate-100">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center shadow-lg shadow-red-500/25">
            <img src="images/Logo.png" alt="Logo" class="w-7 h-7 object-contain" onerror="this.textContent='QH'">
          </div>
          <div>
            <h1 class="text-base font-bold text-slate-800">QuangHưng</h1>
            <p class="text-[10px] text-slate-400 font-medium">Admin Panel</p>
          </div>
        </div>
      </div>
      
      <!-- Navigation -->
      <nav class="flex-1 overflow-y-auto py-4 px-3">
        <p class="text-[10px] font-semibold text-slate-400 uppercase tracking-wider mb-3 px-3">Menu</p>
        <div class="space-y-1">
          <a href="#" onclick="showSection('dashboard')" class="sidebar-item active flex items-center px-3 py-2.5 text-slate-700 group" id="nav-dashboard">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-th-large text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Tổng quan</span>
          </a>
          
          <a href="#" onclick="showSection('orders')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-orders">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-shopping-bag text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Đơn hàng</span>
            <span class="ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold" id="pending-count">0</span>
          </a>
          
          <a href="#" onclick="showSection('products')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-products">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-box text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Sản phẩm</span>
          </a>
          
          <a href="#" onclick="showSection('brands')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-brands">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-tags text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Danh mục</span>
          </a>
          
          <a href="#" onclick="showSection('customers')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-customers">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-users text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Khách hàng</span>
          </a>
          
          <a href="#" onclick="showSection('news')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-news">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-newspaper text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Tin tức</span>
          </a>
          
          <a href="#" onclick="showSection('reviews')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-reviews">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-star text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Đánh giá</span>
          </a>
          
          <a href="#" onclick="showSection('promotions')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-promotions">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-percent text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Khuyến mãi</span>
            <span class="ml-auto bg-amber-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold" id="active-promo-count">0</span>
          </a>
          
          <a href="#" onclick="showSection('contacts')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-contacts">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-envelope text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Liên hệ</span>
            <span class="ml-auto bg-emerald-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold" id="new-contact-count">0</span>
          </a>
          
          <a href="#" onclick="showSection('notifications')" class="sidebar-item flex items-center px-3 py-2.5 text-slate-600 hover:text-slate-800 group" id="nav-notifications">
            <div class="sidebar-icon bg-slate-100 flex items-center justify-center mr-3 transition-all">
              <i class="fas fa-bell text-sm text-slate-500 group-hover:text-red-500"></i>
            </div>
            <span class="text-sm font-medium">Thông báo</span>
          </a>
        </div>
      </nav>
      
      <!-- User Profile -->
      <div class="p-3 border-t border-slate-100">
        <div class="bg-slate-50 rounded-xl p-3">
          <div class="flex items-center gap-3 mb-3">
            <div class="relative">
              <div id="admin-avatar" class="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center font-bold text-sm text-white">AD</div>
              <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-400 rounded-full border-2 border-white"></div>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-slate-800 text-sm truncate" id="admin-name">Admin</p>
              <p class="text-[10px] text-slate-400" id="admin-role">Quản trị viên</p>
            </div>
          </div>
          <button onclick="logout()" class="w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-slate-200 hover:bg-red-50 hover:border-red-200 hover:text-red-600 rounded-lg text-xs font-medium text-slate-600 transition-all">
            <i class="fas fa-sign-out-alt"></i>
            <span>Đăng xuất</span>
          </button>
        </div>
      </div>
    </aside>
    
    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Enhanced Header -->
      <header class="glass-effect shadow-lg px-4 lg:px-8 py-4 relative z-10">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <!-- Mobile menu button -->
            <button class="lg:hidden p-2 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-600">
              <i class="fas fa-bars text-lg"></i>
            </button>
            <div>
              <h2 class="text-2xl font-bold text-dark-800 flex items-center gap-2" id="page-title">
                <span class="w-2 h-8 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full"></span>
                Tổng quan
              </h2>
              <p class="text-sm text-dark-500 mt-0.5" id="welcome-text">Chào mừng trở lại! Đây là Tổng quan hoạt động của bạn</p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <!-- Quick Actions -->
            <div class="hidden md:flex items-center gap-2">
              <button class="p-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors relative">
                <i class="fas fa-bell"></i>
                <span class="notification-dot"></span>
              </button>
              <button class="p-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-600 transition-colors">
                <i class="fas fa-cog"></i>
              </button>
            </div>
            <!-- Date display -->
            <div class="hidden md:flex items-center text-dark-600 bg-gradient-to-r from-primary-50 to-violet-50 px-5 py-2.5 rounded-xl border border-primary-100">
              <i class="fas fa-calendar-alt mr-2 text-primary-500"></i>
              <span class="text-sm font-medium" id="current-date"></span>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Main content area with scroll -->
      <main class="flex-1 overflow-y-auto p-4 lg:p-8">
        <div id="section-dashboard" class="section-content active">
          <!-- thống kê Tổng quan - 4 card với thiết kế mới -->
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
            <!-- Tổng doanh thu -->
            <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg shadow-blue-500/15 p-5 text-white">
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <i class="fas fa-wallet text-xl"></i>
                  </div>
                  <span class="text-white/90 text-xs font-semibold bg-white/20 px-2.5 py-1 rounded-full flex items-center gap-1" id="revenue-change">
                    <i class="fas fa-arrow-up text-[10px]"></i>0%
                  </span>
                </div>
                <p class="text-white/70 text-xs font-medium mb-1">Tổng doanh thu</p>
                <p class="text-2xl font-bold" id="stat-revenue">0đ</p>
                <p class="text-white/50 text-[10px] mt-2">So với tháng trước</p>
              </div>
            </div>
            
            <!-- Số đơn đặt hàng -->
            <div class="stat-card bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl shadow-lg shadow-emerald-500/15 p-5 text-white">
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <i class="fas fa-shopping-cart text-xl"></i>
                  </div>
                  <span class="text-white/90 text-xs font-semibold bg-white/20 px-2.5 py-1 rounded-full flex items-center gap-1" id="orders-change">
                    <i class="fas fa-arrow-up text-[10px]"></i>0%
                  </span>
                </div>
                <p class="text-white/70 text-xs font-medium mb-1">Đơn hàng</p>
                <p class="text-2xl font-bold" id="stat-orders">0</p>
                <p class="text-white/50 text-[10px] mt-2">Tổng đơn trong tháng</p>
              </div>
            </div>
            
            <!-- Khách hàng -->
            <div class="stat-card bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl shadow-lg shadow-amber-500/15 p-5 text-white">
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <i class="fas fa-users text-xl"></i>
                  </div>
                  <span class="text-white/90 text-xs font-semibold bg-white/20 px-2.5 py-1 rounded-full flex items-center gap-1" id="customers-change">
                    <i class="fas fa-arrow-up text-[10px]"></i>0%
                  </span>
                </div>
                <p class="text-white/70 text-xs font-medium mb-1">Khách hàng</p>
                <p class="text-2xl font-bold" id="stat-customers">0</p>
                <p class="text-white/50 text-[10px] mt-2">Tổng khách đăng ký</p>
              </div>
            </div>
            
            <!-- Sản phẩm đã bán -->
            <div class="stat-card bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl shadow-lg shadow-violet-500/15 p-5 text-white">
              <div class="relative z-10">
                <div class="flex items-center justify-between mb-4">
                  <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                    <i class="fas fa-box-open text-xl"></i>
                  </div>
                  <span class="text-white/90 text-xs font-semibold bg-white/20 px-2.5 py-1 rounded-full flex items-center gap-1" id="products-change">
                    <i class="fas fa-arrow-up text-[10px]"></i>0%
                  </span>
                </div>
                <p class="text-white/70 text-xs font-medium mb-1">Sản phẩm đã bán</p>
                <p class="text-2xl font-bold" id="stat-products">0</p>
                <p class="text-white/50 text-[10px] mt-2">Tổng số lượng bán ra</p>
              </div>
            </div>
          </div>

          <!-- Row 2: Biểu đồ doanh thu + Top Sản phẩm bán chạy -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
            <!-- Biểu đồ doanh thu - chiếm 2 cột -->
            <div class="xl:col-span-2 glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h3 class="text-lg font-bold text-dark-800 flex items-center gap-2">
                    <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                    Doanh thu thực tế theo tháng
                  </h3>
                  <p class="text-sm text-dark-400 mt-1">Nam 2024</p>
                </div>
                <div class="flex items-center gap-4 text-sm">
                  <span class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-gradient-to-r from-primary-500 to-violet-500"></span>
                    <span class="text-dark-500">thực tế</span>
                  </span>
                  <span class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full bg-slate-300"></span>
                    <span class="text-dark-500">Kế hoạch</span>
                  </span>
                </div>
              </div>
              <div class="relative" style="height: 250px;">
                <canvas id="revenueChart"></canvas>
              </div>
            </div>

            <!-- Top 5 Sản phẩm bán chạy -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h3 class="text-lg font-bold text-dark-800 flex items-center gap-2">
                    <span class="text-2xl">📦</span>
                    Top Sản phẩm bán chạy
                  </h3>
                  <p class="text-sm text-dark-400 mt-1">Top 5 Sản phẩm có doanh số cao nhất</p>
                </div>
              </div>
              <div class="space-y-4" id="top-products-list">
                <!-- Skeleton loading với hiệu ứng mới -->
                <div class="flex items-center gap-4 p-3 rounded-2xl shimmer">
                  <div class="w-14 h-14 bg-slate-200 rounded-xl"></div>
                  <div class="flex-1">
                    <div class="h-4 bg-slate-200 rounded-lg w-3/4 mb-2"></div>
                    <div class="h-3 bg-slate-100 rounded-lg w-1/2"></div>
                  </div>
                  <div class="h-8 w-8 bg-slate-200 rounded-full"></div>
                </div>
                <div class="flex items-center gap-4 p-3 rounded-2xl shimmer">
                  <div class="w-14 h-14 bg-slate-200 rounded-xl"></div>
                  <div class="flex-1">
                    <div class="h-4 bg-slate-200 rounded-lg w-3/4 mb-2"></div>
                    <div class="h-3 bg-slate-100 rounded-lg w-1/2"></div>
                  </div>
                  <div class="h-8 w-8 bg-slate-200 rounded-full"></div>
                </div>
                <div class="flex items-center gap-4 p-3 rounded-2xl shimmer">
                  <div class="w-14 h-14 bg-slate-200 rounded-xl"></div>
                  <div class="flex-1">
                    <div class="h-4 bg-slate-200 rounded-lg w-3/4 mb-2"></div>
                    <div class="h-3 bg-slate-100 rounded-lg w-1/2"></div>
                  </div>
                  <div class="h-8 w-8 bg-slate-200 rounded-full"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Row 3: Đơn hàng theo trạng thái + Đơn hàng gần đây -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
            <!-- Đơn hàng theo trạng thái -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-6 flex items-center gap-2">
                <span class="w-3 h-3 bg-emerald-500 rounded-full"></span>
                Đơn hàng theo trạng thái
              </h3>
              <div class="relative" style="height: 220px;">
                <canvas id="ordersChart"></canvas>
              </div>
            </div>
            
            <!-- Đơn hàng gần đây - chiếm 2 cột -->
            <div class="xl:col-span-2 glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                  Đơn hàng gần đây
                </h3>
                <a href="#" onclick="showSection('orders')" class="text-primary-600 text-sm font-medium hover:text-primary-700 flex items-center gap-1 group">
                  Xem tất cả 
                  <i class="fas fa-arrow-right text-xs transition-transform group-hover:translate-x-1"></i>
                </a>
              </div>
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="text-left text-dark-400 text-sm border-b border-slate-200">
                      <th class="pb-4 font-semibold">mã don</th>
                      <th class="pb-4 font-semibold">Khách hàng</th>
                      <th class="pb-4 font-semibold">Tổng tiền</th>
                      <th class="pb-4 font-semibold">trạng thái</th>
                      <th class="pb-4 font-semibold">ngày đãt</th>
                    </tr>
                  </thead>
                  <tbody id="recent-orders-table">
                    <tr><td colspan="5" class="py-8 text-center text-dark-400">
                      <div class="flex flex-col items-center gap-2">
                        <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                          <i class="fas fa-spinner fa-spin text-slate-400"></i>
                        </div>
                        <span>Đang tải...</span>
                      </div>
                    </td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div id="section-orders" class="section-content">
          <!-- thống kê đơn hàng với Biểu đồ -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
            <!-- thống kê nhanh đơn hàng -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                thống kê nhanh
              </h3>
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl p-4 text-center border border-amber-100">
                  <div class="text-3xl font-extrabold text-amber-600" id="orders-pending-count">0</div>
                  <div class="text-xs text-dark-500 mt-1">Chờ xử lý</div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-4 text-center border border-blue-100">
                  <div class="text-3xl font-extrabold text-blue-600" id="orders-confirmed-count">0</div>
                  <div class="text-xs text-dark-500 mt-1">Đã xác nhận</div>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-4 text-center border border-purple-100">
                  <div class="text-3xl font-extrabold text-purple-600" id="orders-shipping-count">0</div>
                  <div class="text-xs text-dark-500 mt-1">Đang giao</div>
                </div>
                <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4 text-center border border-emerald-100">
                  <div class="text-3xl font-extrabold text-emerald-600" id="orders-delivered-count">0</div>
                  <div class="text-xs text-dark-500 mt-1">Đã giao</div>
                </div>
              </div>
            </div>
            
            <!-- Biểu đồ đơn hàng theo trạng thái -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-emerald-500 rounded-full"></span>
                Phân bố trạng thái đơn hàng
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="ordersStatusPieChart"></canvas>
              </div>
            </div>
            
            <!-- Biểu đồ đơn hàng theo ngày -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                Đơn hàng 7 ngày gần nhất
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="ordersWeeklyChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                  quản lý đơn hàng
                </h3>
                <p class="text-sm text-dark-400 mt-1">Theo dõi và xử lý tất cả đơn hàng</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="order-search" placeholder="Tìm đơn hàng..." class="bg-transparent outline-none text-sm w-40 modern-input">
                </div>
                <select id="order-status-filter" class="border border-slate-200 rounded-xl px-4 py-2.5 text-sm bg-white hover:border-primary-400 focus:ring-2 focus:ring-primary-500/20 focus:border-primary-400 transition-all cursor-pointer">
                  <option value="">Tất cả trạng thái</option>
                  <option value="pending">🔵 Chờ xử lý</option>
                  <option value="confirmed">🔵 Đã xác nhận</option>
                  <option value="shipping">📦 Đang giao</option>
                  <option value="delivered">📦 Đã giao</option>
                  <option value="cancelled">🔵 Đã hủy</option>
                </select>
              </div>
            </div>
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">mã don</th>
                    <th class="px-6 py-4 font-semibold">Khách hàng</th>
                    <th class="px-6 py-4 font-semibold">SĐT</th>
                    <th class="px-6 py-4 font-semibold">Tổng tiền</th>
                    <th class="px-6 py-4 font-semibold">trạng thái</th>
                    <th class="px-6 py-4 font-semibold">ngày đãt</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="orders-table" class="divide-y divide-slate-100">
                  <tr><td colspan="7" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div id="section-products" class="section-content">
          <!-- thống kê Sản phẩm với Biểu đồ -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
            <!-- thống kê nhanh Sản phẩm -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-emerald-500 rounded-full"></span>
                thống kê Sản phẩm
              </h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center text-white">
                      <i class="fas fa-box"></i>
                    </div>
                    <span class="font-medium text-dark-700">Tổng Sản phẩm</span>
                  </div>
                  <span class="text-2xl font-bold text-blue-600" id="products-total-count">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center text-white">
                      <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="font-medium text-dark-700">Còn hàng</span>
                  </div>
                  <span class="text-2xl font-bold text-emerald-600" id="products-instock-count">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-rose-50 to-pink-50 rounded-xl border border-rose-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-rose-500 flex items-center justify-center text-white">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <span class="font-medium text-dark-700">Hết hàng</span>
                  </div>
                  <span class="text-2xl font-bold text-rose-600" id="products-outofstock-count">0</span>
                </div>
              </div>
            </div>
            
            <!-- Biểu đồ Sản phẩm theo hãng -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                Sản phẩm theo hãng
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="productsByBrandChart"></canvas>
              </div>
            </div>
            
            <!-- Biểu đồ giá Sản phẩm -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                Phân bố giá Sản phẩm
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="productsPriceChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-emerald-500 rounded-full"></span>
                  quản lý Sản phẩm
                </h3>
                <p class="text-sm text-dark-400 mt-1">Thêm, sửa, xóa Sản phẩm trong cửa hàng</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="product-search" placeholder="Tìm Sản phẩm..." class="bg-transparent outline-none text-sm w-40 modern-input">
                </div>
                <select id="product-brand-filter" class="border border-slate-200 rounded-xl px-4 py-2.5 text-sm bg-white hover:border-primary-400 focus:ring-2 focus:ring-primary-500/20 focus:border-primary-400 transition-all cursor-pointer">
                  <option value="">Tất cả hãng</option>
                </select>
                <button onclick="openProductModal()" class="btn-primary text-white px-5 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2">
                  <i class="fas fa-plus"></i>
                  <span>Thêm Sản phẩm</span>
                </button>
              </div>
            </div>
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">Ảnh</th>
                    <th class="px-6 py-4 font-semibold">Tên Sản phẩm</th>
                    <th class="px-6 py-4 font-semibold">Hãng</th>
                    <th class="px-6 py-4 font-semibold">Giá</th>
                    <th class="px-6 py-4 font-semibold">Số lượng</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="products-table" class="divide-y divide-slate-100">
                  <tr><td colspan="6" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- Section quản lý Danh mục (Hãng sản xuất) -->
        <div id="section-brands" class="section-content">
          <!-- Biểu đồ thống kê Danh mục -->
          <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
            <!-- Biểu đồ số Sản phẩm theo hãng -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                số Sản phẩm theo hãng
              </h3>
              <div class="relative" style="height: 220px;">
                <canvas id="brandsProductsChart"></canvas>
              </div>
            </div>
            
            <!-- Biểu đồ Hãng theo quốc gia -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-emerald-500 rounded-full"></span>
                Hãng theo quốc gia
              </h3>
              <div class="relative" style="height: 220px;">
                <canvas id="brandsByCountryChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                  quản lý Danh mục (Hãng sản xuất)
                </h3>
                <p class="text-sm text-dark-400 mt-1">quản lý thương hiệu và Hãng sản xuất</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="brand-search" placeholder="Tìm Hãng..." class="bg-transparent outline-none text-sm w-40 modern-input">
                </div>
                <button onclick="openBrandModal()" class="btn-primary text-white px-5 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2">
                  <i class="fas fa-plus"></i>
                  <span>Thêm Hãng mới</span>
                </button>
              </div>
            </div>
            
            <!-- thống kê với thiết kế mới -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div class="bg-gradient-to-br from-primary-50 to-violet-50 rounded-2xl p-5 text-center border border-primary-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-primary-600 to-violet-600 bg-clip-text text-transparent" id="total-brands">0</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">têng số Hãng</div>
              </div>
              <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 text-center border border-emerald-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent" id="brands-with-products">0</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Có Sản phẩm</div>
              </div>
              <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5 text-center border border-amber-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent" id="brands-empty">0</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Chưa có SP</div>
              </div>
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 text-center border border-blue-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent" id="total-countries">0</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">quốc gia</div>
              </div>
            </div>
            
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">STT</th>
                    <th class="px-6 py-4 font-semibold">Tên Hãng</th>
                    <th class="px-6 py-4 font-semibold">quốc gia</th>
                    <th class="px-6 py-4 font-semibold">số Sản phẩm</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="brands-table" class="divide-y divide-slate-100">
                  <tr><td colspan="5" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div id="section-customers" class="section-content">
          <!-- thống kê Khách hàng với Biểu đồ -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
            <!-- thống kê nhanh -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                thống kê Khách hàng
              </h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-blue-500 flex items-center justify-center text-white">
                      <i class="fas fa-users"></i>
                    </div>
                    <span class="font-medium text-dark-700">Tổng Khách hàng</span>
                  </div>
                  <span class="text-2xl font-bold text-blue-600" id="customers-total-stat">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center text-white">
                      <i class="fas fa-user-check"></i>
                    </div>
                    <span class="font-medium text-dark-700">Đã mua hàng</span>
                  </div>
                  <span class="text-2xl font-bold text-emerald-600" id="customers-purchased-stat">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-amber-500 flex items-center justify-center text-white">
                      <i class="fas fa-crown"></i>
                    </div>
                    <span class="font-medium text-dark-700">Khách VIP</span>
                  </div>
                  <span class="text-2xl font-bold text-amber-600" id="customers-vip-stat">0</span>
                </div>
              </div>
            </div>
            
            <!-- Biểu đồ Khách hàng theo tháng -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                Khách hàng mới theo tháng
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="customersMonthlyChart"></canvas>
              </div>
            </div>
            
            <!-- Biểu đồ top Khách hàng chi tiêu -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                Top Khách hàng chi tiêu
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="customersTopSpendingChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                  quản lý Khách hàng
                </h3>
                <p class="text-sm text-dark-400 mt-1">Danh sách và thông tin Khách hàng</p>
              </div>
              <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                <i class="fas fa-search text-slate-400 mr-2"></i>
                <input type="text" id="customer-search" placeholder="Tìm Khách hàng..." class="bg-transparent outline-none text-sm w-48 modern-input">
              </div>
            </div>
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">Avatar</th>
                    <th class="px-6 py-4 font-semibold">Họ tên</th>
                    <th class="px-6 py-4 font-semibold">Email</th>
                    <th class="px-6 py-4 font-semibold">SĐT</th>
                    <th class="px-6 py-4 font-semibold">Đơn hàng</th>
                    <th class="px-6 py-4 font-semibold">têng chi tiêu</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="customers-table" class="divide-y divide-slate-100">
                  <tr><td colspan="7" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div id="section-news" class="section-content">
          <!-- thống kê Tin tức với Biểu đồ -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
            <!-- thống kê nhanh -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-cyan-500 rounded-full"></span>
                thống kê Tin tức
              </h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl border border-cyan-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-cyan-500 flex items-center justify-center text-white">
                      <i class="fas fa-newspaper"></i>
                    </div>
                    <span class="font-medium text-dark-700">Tổng Tin tức</span>
                  </div>
                  <span class="text-2xl font-bold text-cyan-600" id="news-total-stat">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500 flex items-center justify-center text-white">
                      <i class="fas fa-calendar-week"></i>
                    </div>
                    <span class="font-medium text-dark-700">Tin trong tháng</span>
                  </div>
                  <span class="text-2xl font-bold text-emerald-600" id="news-monthly-stat">0</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-violet-50 to-purple-50 rounded-xl border border-violet-100">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-violet-500 flex items-center justify-center text-white">
                      <i class="fas fa-eye"></i>
                    </div>
                    <span class="font-medium text-dark-700">Lượt xem</span>
                  </div>
                  <span class="text-2xl font-bold text-violet-600" id="news-views-stat">0</span>
                </div>
              </div>
            </div>
            
            <!-- Biểu đồ Tin tức theo tháng -->
            <div class="xl:col-span-2 glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                Tin tức dang theo tháng
              </h3>
              <div class="relative" style="height: 180px;">
                <canvas id="newsMonthlyChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-cyan-500 rounded-full"></span>
                  quản lý Tin tức
                </h3>
                <p class="text-sm text-dark-400 mt-1">Đăng và quản lý bài viết Tin tức</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="news-search" placeholder="Tìm Tin tức..." class="bg-transparent outline-none text-sm w-40 modern-input">
                </div>
                <button onclick="openNewsModal()" class="btn-primary text-white px-5 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2">
                  <i class="fas fa-plus"></i>
                  <span>Thêm Tin tức</span>
                </button>
              </div>
            </div>
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">Ảnh</th>
                    <th class="px-6 py-4 font-semibold">Tiêu đề</th>
                    <th class="px-6 py-4 font-semibold">Tác giả</th>
                    <th class="px-6 py-4 font-semibold">ngày dang</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="news-table" class="divide-y divide-slate-100">
                  <tr><td colspan="5" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div id="section-reviews" class="section-content">
          <!-- Biểu đồ đánh giá -->
          <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
            <!-- Biểu đồ đánh giá theo số sao -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                Phân bố đánh giá theo sao
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="reviewsRatingChart"></canvas>
              </div>
            </div>
            
            <!-- Biểu đồ đánh giá theo tháng -->
            <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
              <h3 class="text-lg font-bold text-dark-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                Đánh giá theo tháng
              </h3>
              <div class="relative" style="height: 200px;">
                <canvas id="reviewsMonthlyChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-rose-500 rounded-full"></span>
                  quản lý đánh giá
                </h3>
                <p class="text-sm text-dark-400 mt-1">Xem và quản lý đánh giá Sản phẩm</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200 focus-within:ring-2 focus-within:ring-primary-500/20 focus-within:border-primary-400 transition-all">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="review-search" placeholder="Tìm đánh giá..." class="bg-transparent outline-none text-sm w-40 modern-input">
                </div>
                <select id="review-rating-filter" class="border border-slate-200 rounded-xl px-4 py-2.5 text-sm bg-white hover:border-primary-400 focus:ring-2 focus:ring-primary-500/20 focus:border-primary-400 transition-all cursor-pointer">
                  <option value="">Tất cả sao</option>
                  <option value="5">📦⭐⭐⭐ 5 sao</option>
                  <option value="4">📦📦 4 sao</option>
                  <option value="3">⭐⭐⭐ 3 sao</option>
                  <option value="2">📦 2 sao</option>
                  <option value="1">🔵 1 sao</option>
                </select>
              </div>
            </div>
            
            <!-- thống kê đánh giá -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl p-5 text-center border border-amber-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-amber-500 to-yellow-500 bg-clip-text text-transparent flex items-center justify-center gap-1" id="avg-rating">
                  <span>0</span>
                  <i class="fas fa-star text-amber-400 text-2xl"></i>
                </div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Điểm trung bình</div>
              </div>
              <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5 text-center border border-emerald-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent" id="total-reviews">0</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Tổng đánh giá</div>
              </div>
              <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-5 text-center border border-blue-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent" id="positive-reviews">0%</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Đánh giá tích cực</div>
              </div>
              <div class="bg-gradient-to-br from-rose-50 to-pink-50 rounded-2xl p-5 text-center border border-rose-100">
                <div class="text-4xl font-extrabold bg-gradient-to-r from-rose-500 to-pink-500 bg-clip-text text-transparent" id="negative-reviews">0%</div>
                <div class="text-sm text-dark-500 mt-1 font-medium">Đánh giá tiêu cực</div>
              </div>
            </div>
            
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">Khách hàng</th>
                    <th class="px-6 py-4 font-semibold">Sản phẩm</th>
                    <th class="px-6 py-4 font-semibold">Đánh giá</th>
                    <th class="px-6 py-4 font-semibold">Nội dung</th>
                    <th class="px-6 py-4 font-semibold">ngày</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="reviews-table" class="divide-y divide-slate-100">
                  <tr><td colspan="6" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Section Khuyến mãi -->
        <div id="section-promotions" class="section-content">
          <!-- Thống kê khuyến mãi -->
          <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-5 text-white">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <i class="fas fa-tags text-2xl"></i>
                </div>
                <div>
                  <p class="text-3xl font-bold" id="promo-total">0</p>
                  <p class="text-sm text-white/80">Tổng khuyến mãi</p>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl p-5 text-white">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <i class="fas fa-check-circle text-2xl"></i>
                </div>
                <div>
                  <p class="text-3xl font-bold" id="promo-active">0</p>
                  <p class="text-sm text-white/80">Đang hoạt động</p>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-5 text-white">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <i class="fas fa-clock text-2xl"></i>
                </div>
                <div>
                  <p class="text-3xl font-bold" id="promo-upcoming">0</p>
                  <p class="text-sm text-white/80">Sắp diễn ra</p>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-rose-500 to-pink-600 rounded-2xl p-5 text-white">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <i class="fas fa-times-circle text-2xl"></i>
                </div>
                <div>
                  <p class="text-3xl font-bold" id="promo-expired">0</p>
                  <p class="text-sm text-white/80">Đã hết hạn</p>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl p-5 text-white">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center">
                  <i class="fas fa-ticket text-2xl"></i>
                </div>
                <div>
                  <p class="text-3xl font-bold" id="promo-used">0</p>
                  <p class="text-sm text-white/80">Lượt sử dụng</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bảng quản lý khuyến mãi -->
          <div class="glass-effect rounded-3xl shadow-xl p-6 border border-white/50">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-dark-800 flex items-center gap-2">
                  <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                  Quản lý Khuyến mãi
                </h3>
                <p class="text-sm text-dark-400 mt-1">Tạo và quản lý mã giảm giá, voucher</p>
              </div>
              <div class="flex flex-wrap gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2.5 border border-slate-200">
                  <i class="fas fa-search text-slate-400 mr-2"></i>
                  <input type="text" id="promo-search" placeholder="Tìm khuyến mãi..." class="bg-transparent outline-none text-sm w-40">
                </div>
                <select id="promo-status-filter" class="border border-slate-200 rounded-xl px-4 py-2.5 text-sm bg-white">
                  <option value="">Tất cả trạng thái</option>
                  <option value="active">Đang hoạt động</option>
                  <option value="inactive">Tạm dừng</option>
                  <option value="expired">Hết hạn</option>
                </select>
                <button onclick="syncPromotionUsage()" class="border border-emerald-500 text-emerald-600 px-4 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2 hover:bg-emerald-50 transition-colors" title="Đồng bộ số lượng đã dùng từ đơn hàng">
                  <i class="fas fa-sync-alt"></i>
                  <span>Đồng bộ</span>
                </button>
                <button onclick="openPromotionModal()" class="btn-primary text-white px-5 py-2.5 rounded-xl text-sm font-semibold flex items-center gap-2">
                  <i class="fas fa-plus"></i>
                  <span>Thêm khuyến mãi</span>
                </button>
              </div>
            </div>
            
            <div class="overflow-x-auto rounded-2xl border border-slate-200">
              <table class="w-full">
                <thead class="bg-gradient-to-r from-slate-50 to-slate-100">
                  <tr class="text-left text-dark-500 text-sm">
                    <th class="px-6 py-4 font-semibold">Mã</th>
                    <th class="px-6 py-4 font-semibold">Loại</th>
                    <th class="px-6 py-4 font-semibold">Giá trị</th>
                    <th class="px-6 py-4 font-semibold">Điều kiện</th>
                    <th class="px-6 py-4 font-semibold">Số lượng</th>
                    <th class="px-6 py-4 font-semibold">Thời gian</th>
                    <th class="px-6 py-4 font-semibold">Trạng thái</th>
                    <th class="px-6 py-4 font-semibold">Thao tác</th>
                  </tr>
                </thead>
                <tbody id="promotions-table" class="divide-y divide-slate-100">
                  <tr><td colspan="8" class="px-6 py-12 text-center text-dark-400">
                    <div class="flex flex-col items-center gap-2">
                      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center">
                        <i class="fas fa-spinner fa-spin text-slate-400"></i>
                      </div>
                      <span>Đang tải...</span>
                    </div>
                  </td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      
        <!-- Section Liên hệ -->
        <div id="section-contacts" class="section-content">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-xl p-4 shadow-sm"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center"><i class="fas fa-envelope text-blue-600 text-xl"></i></div><div><p class="text-2xl font-bold text-slate-800" id="contact-total">0</p><p class="text-sm text-slate-500">Tổng liên hệ</p></div></div></div>
            <div class="bg-white rounded-xl p-4 shadow-sm"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center"><i class="fas fa-envelope-open text-emerald-600 text-xl"></i></div><div><p class="text-2xl font-bold text-emerald-600" id="contact-new">0</p><p class="text-sm text-slate-500">Mới</p></div></div></div>
            <div class="bg-white rounded-xl p-4 shadow-sm"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-amber-100 flex items-center justify-center"><i class="fas fa-eye text-amber-600 text-xl"></i></div><div><p class="text-2xl font-bold text-amber-600" id="contact-read">0</p><p class="text-sm text-slate-500">Đã xem</p></div></div></div>
            <div class="bg-white rounded-xl p-4 shadow-sm"><div class="flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-violet-100 flex items-center justify-center"><i class="fas fa-reply text-violet-600 text-xl"></i></div><div><p class="text-2xl font-bold text-violet-600" id="contact-replied">0</p><p class="text-sm text-slate-500">Đã phản hồi</p></div></div></div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
              <h3 class="text-lg font-bold text-slate-800">Quản lý liên hệ</h3>
              <div class="flex gap-3">
                <div class="flex items-center bg-slate-100 rounded-xl px-4 py-2"><i class="fas fa-search text-slate-400 mr-2"></i><input type="text" id="contact-search" placeholder="Tìm liên hệ..." class="bg-transparent outline-none text-sm w-40"></div>
                <select id="contact-status-filter" class="border border-slate-200 rounded-xl px-4 py-2 text-sm"><option value="">Tất cả</option><option value="new">Mới</option><option value="read">Đã xem</option><option value="replied">Đã phản hồi</option></select>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead><tr class="text-left text-slate-500 text-sm border-b border-slate-100"><th class="pb-4">Họ tên</th><th class="pb-4">Email</th><th class="pb-4">SĐT</th><th class="pb-4">Chủ đề</th><th class="pb-4">Trạng thái</th><th class="pb-4">Ngày gửi</th><th class="pb-4">Thao tác</th></tr></thead>
                <tbody id="contacts-table"><tr><td colspan="7" class="py-8 text-center text-slate-400">Đang tải...</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Section Thông báo -->
        <div id="section-notifications" class="section-content">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Form gửi thông báo -->
            <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-primary-500 rounded-full"></span>
                Gửi thông báo cho khách hàng
              </h3>
              <form id="notification-form" class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Gửi đến</label>
                  <select id="notif-target" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
                    <option value="all">Tất cả khách hàng</option>
                    <option value="single">Một khách hàng cụ thể</option>
                  </select>
                </div>
                <div id="single-customer-select" class="hidden">
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Chọn khách hàng</label>
                  <select id="notif-customer" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
                    <option value="">-- Chọn khách hàng --</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Loại thông báo</label>
                  <select id="notif-type" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
                    <option value="system">Hệ thống</option>
                    <option value="promotion">Khuyến mãi</option>
                    <option value="order_update">Cập nhật đơn hàng</option>
                    <option value="contact_response">Phản hồi liên hệ</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Tiêu đề <span class="text-rose-500">*</span></label>
                  <input type="text" id="notif-title" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="Nhập tiêu đề thông báo...">
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Nội dung <span class="text-rose-500">*</span></label>
                  <textarea id="notif-content" rows="4" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all resize-none" placeholder="Nhập nội dung thông báo..."></textarea>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Link đính kèm (tùy chọn)</label>
                  <input type="text" id="notif-link" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="VD: promotions.html hoặc product-detail.html?id=1">
                </div>
                <button type="submit" class="w-full btn-primary text-white px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2">
                  <i class="fas fa-paper-plane"></i>
                  Gửi thông báo
                </button>
              </form>
            </div>
            
            <!-- Quick templates -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                <span class="w-3 h-3 bg-amber-500 rounded-full"></span>
                Mẫu thông báo nhanh
              </h3>
              <div class="space-y-3">
                <button onclick="useNotifTemplate('promo')" class="w-full text-left p-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200 hover:shadow-md transition">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                      <i class="fas fa-gift text-white"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-slate-800">Khuyến mãi mới</p>
                      <p class="text-xs text-slate-500">Thông báo về chương trình giảm giá</p>
                    </div>
                  </div>
                </button>
                <button onclick="useNotifTemplate('flash')" class="w-full text-left p-3 bg-gradient-to-r from-rose-50 to-pink-50 rounded-xl border border-rose-200 hover:shadow-md transition">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-rose-500 rounded-lg flex items-center justify-center">
                      <i class="fas fa-bolt text-white"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-slate-800">Flash Sale</p>
                      <p class="text-xs text-slate-500">Thông báo flash sale giới hạn</p>
                    </div>
                  </div>
                </button>
                <button onclick="useNotifTemplate('newproduct')" class="w-full text-left p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 hover:shadow-md transition">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                      <i class="fas fa-mobile-alt text-white"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-slate-800">Sản phẩm mới</p>
                      <p class="text-xs text-slate-500">Thông báo ra mắt sản phẩm</p>
                    </div>
                  </div>
                </button>
                <button onclick="useNotifTemplate('thanks')" class="w-full text-left p-3 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border border-emerald-200 hover:shadow-md transition">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center">
                      <i class="fas fa-heart text-white"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-slate-800">Cảm ơn khách hàng</p>
                      <p class="text-xs text-slate-500">Gửi lời cảm ơn đến khách</p>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Lịch sử thông báo -->
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <span class="w-3 h-3 bg-violet-500 rounded-full"></span>
                Lịch sử thông báo đã gửi
              </h3>
              <button onclick="loadNotificationHistory()" class="text-sm text-primary-600 hover:underline">
                <i class="fas fa-sync-alt mr-1"></i> Làm mới
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="text-left text-slate-500 text-sm border-b border-slate-100">
                    <th class="pb-3">Tiêu đề</th>
                    <th class="pb-3">Loại</th>
                    <th class="pb-3">Người nhận</th>
                    <th class="pb-3">Ngày gửi</th>
                    <th class="pb-3">Trạng thái</th>
                  </tr>
                </thead>
                <tbody id="notification-history-table">
                  <tr><td colspan="5" class="py-8 text-center text-slate-400">Đang tải...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <!-- Enhanced Toast Notification -->
  <div id="toast" class="fixed bottom-6 right-6 z-50 transform translate-y-20 opacity-0 transition-all duration-500">
    <div class="glass-effect shadow-2xl px-6 py-4 rounded-2xl flex items-center gap-4 border border-white/50">
      <div class="w-10 h-10 rounded-full bg-gradient-to-r from-emerald-400 to-teal-400 flex items-center justify-center">
        <i id="toast-icon" class="fas fa-check text-white"></i>
      </div>
      <div>
        <p class="font-semibold text-dark-800">Thành công!</p>
        <p id="toast-message" class="text-sm text-dark-500">Thao tác đã hoàn thành</p>
      </div>
      <button onclick="hideToast()" class="ml-4 text-dark-400 hover:text-dark-600 transition-colors">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
  
  <!-- Promotion Modal -->
  <div id="promotion-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white/95 backdrop-blur-sm p-6 border-b border-slate-200 rounded-t-3xl z-10">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-dark-800" id="promotion-modal-title">Thêm khuyến mãi mới</h3>
            <p class="text-sm text-dark-400 mt-1">Tạo mã giảm giá, voucher cho khách hàng</p>
          </div>
          <button onclick="closePromotionModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-dark-400 hover:text-dark-600 transition-colors">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <form id="promotion-form" class="p-6 space-y-5">
        <input type="hidden" id="promotion-id">
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Mã khuyến mãi <span class="text-rose-500">*</span></label>
            <input type="text" id="promotion-code" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all uppercase" placeholder="VD: GIAM20">
          </div>
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Loại khuyến mãi</label>
            <select id="promotion-type" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
              <option value="voucher">Voucher giảm giá</option>
              <option value="free_ship">Miễn phí vận chuyển</option>
              <option value="flash_sale">Flash Sale</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Kiểu giảm giá</label>
            <select id="promotion-discount-type" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
              <option value="percent">Phần trăm (%)</option>
              <option value="fixed">Số tiền cố định (VNĐ)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Giá trị giảm <span class="text-rose-500">*</span></label>
            <input type="number" id="promotion-value" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="VD: 20 hoặc 50000">
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-semibold text-dark-700 mb-2">Mô tả</label>
          <textarea id="promotion-desc" rows="2" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all resize-none" placeholder="Mô tả ngắn về khuyến mãi..."></textarea>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Đơn tối thiểu (VNĐ)</label>
            <input type="number" id="promotion-min" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="0" value="0">
          </div>
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Giảm tối đa (VNĐ)</label>
            <input type="number" id="promotion-max" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="Không giới hạn">
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Số lượng</label>
            <input type="number" id="promotion-quantity" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="100" value="100">
          </div>
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Trạng thái</label>
            <select id="promotion-status" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
              <option value="active">Hoạt động</option>
              <option value="inactive">Tạm dừng</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Ngày bắt đầu <span class="text-rose-500">*</span></label>
            <input type="datetime-local" id="promotion-start" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
          </div>
          <div>
            <label class="block text-sm font-semibold text-dark-700 mb-2">Ngày kết thúc <span class="text-rose-500">*</span></label>
            <input type="datetime-local" id="promotion-end" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all">
          </div>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closePromotionModal()" class="flex-1 border-2 border-slate-200 text-dark-600 py-3 rounded-xl font-semibold hover:bg-slate-50 transition-colors">Hủy</button>
          <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold">
            <i class="fas fa-save mr-2"></i><span id="promotion-submit-text">Lưu khuyến mãi</span>
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Product Modal - Enhanced Design -->
  <div id="product-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white/95 backdrop-blur-sm p-6 border-b border-slate-200 rounded-t-3xl z-10">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-dark-800" id="product-modal-title">Thêm Sản phẩm mới</h3>
            <p class="text-sm text-dark-400 mt-1">Điền thông tin Sản phẩm bên dưới</p>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 text-sm bg-primary-50 text-primary-700 px-4 py-2 rounded-full font-medium">
              <span class="w-6 h-6 rounded-full bg-gradient-to-r from-primary-500 to-violet-500 text-white flex items-center justify-center text-xs font-bold">1</span>
              <span>Thông tin cơ bản</span>
            </div>
            <button onclick="closeProductModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-dark-400 hover:text-dark-600 transition-colors">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="p-6">
        <form id="product-form">
          <input type="hidden" id="product-id">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-tag text-primary-500 mr-1"></i>
                Tên Sản phẩm <span class="text-rose-500">*</span>
              </label>
              <input type="text" id="product-name" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="VD: iPhone 16 Pro Max 256GB">
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-building text-primary-500 mr-1"></i>
                Hãng <span class="text-rose-500">*</span>
              </label>
              <select id="product-brand" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn Hãng</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-money-bill text-emerald-500 mr-1"></i>
                Giá (VNĐ) <span class="text-rose-500">*</span>
              </label>
              <input type="number" id="product-price" required min="0" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="VD: 29990000">
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-boxes text-amber-500 mr-1"></i>
                Số lượng <span class="text-rose-500">*</span>
              </label>
              <input type="number" id="product-stock" required min="0" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="VD: 50">
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-palette text-violet-500 mr-1"></i>
                Màu sắc <span class="text-xs text-dark-400 font-normal">(Chọn từ bảng màu hoặc tự thêm)</span>
              </label>
              <input type="hidden" id="product-color" value="">
              <input type="hidden" id="product-color-names" value="">
              
              <!-- Màu đã chọn -->
              <div id="selected-colors" class="flex flex-wrap gap-2 mb-3 min-h-[50px] p-3 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50">
                <span class="text-dark-400 text-sm" id="color-placeholder">Chưa chọn màu nào...</span>
              </div>
              
              <!-- Thêm màu tùy chỉnh -->
              <div class="flex items-center gap-2 mb-3 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                <input type="color" id="custom-color-picker" value="#FF6B00" class="w-12 h-12 rounded-xl cursor-pointer border-0 shadow-inner">
                <input type="text" id="custom-color-name" placeholder="Nhập tên màu (VD: Titan Cam)" class="flex-1 border-2 border-slate-200 rounded-xl px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500">
                <button type="button" onclick="addCustomColor()" class="px-5 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white rounded-xl text-sm font-semibold flex items-center gap-2 shadow-lg shadow-blue-500/25 transition-all">
                  <i class="fas fa-plus"></i> Thêm
                </button>
              </div>
              
              <!-- Bảng màu gợi ý -->
              <p class="text-xs text-dark-500 mb-3 flex items-center gap-1"><i class="fas fa-palette text-violet-500"></i>Hoặc chọn nhanh từ bảng màu:</p>
              <div class="grid grid-cols-8 gap-2" id="color-picker-grid">
                <!-- Màu cơ bản -->
                <button type="button" onclick="toggleColor('#000000', 'Đen')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#000000" title="Đen" data-color="#000000" data-name="Đen"></button>
                <button type="button" onclick="toggleColor('#FFFFFF', 'Trắng')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FFFFFF" title="Trắng" data-color="#FFFFFF" data-name="Trắng"></button>
                <button type="button" onclick="toggleColor('#C0C0C0', 'Bạc')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#C0C0C0" title="Bạc" data-color="#C0C0C0" data-name="Bạc"></button>
                <button type="button" onclick="toggleColor('#808080', 'Xám')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#808080" title="Xám" data-color="#808080" data-name="Xám"></button>
                <button type="button" onclick="toggleColor('#FFD700', 'Vàng Gold')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FFD700" title="Vàng Gold" data-color="#FFD700" data-name="Vàng Gold"></button>
                <button type="button" onclick="toggleColor('#FFC0CB', 'Hồng')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FFC0CB" title="Hồng" data-color="#FFC0CB" data-name="Hồng"></button>
                <button type="button" onclick="toggleColor('#FF6B00', 'Cam')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FF6B00" title="Cam" data-color="#FF6B00" data-name="Cam"></button>
                <button type="button" onclick="toggleColor('#FF0000', 'Đỏ')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FF0000" title="Đỏ" data-color="#FF0000" data-name="Đỏ"></button>
                <!-- mãu xanh -->
                <button type="button" onclick="toggleColor('#0000FF', 'Xanh Duong')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#0000FF" title="Xanh Duong" data-color="#0000FF" data-name="Xanh Duong"></button>
                <button type="button" onclick="toggleColor('#00BFFF', 'Xanh Da Trời')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#00BFFF" title="Xanh Da Trời" data-color="#00BFFF" data-name="Xanh Da Trời"></button>
                <button type="button" onclick="toggleColor('#008000', 'Xanh Lá')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#008000" title="Xanh Lá" data-color="#008000" data-name="Xanh Lá"></button>
                <button type="button" onclick="toggleColor('#90EE90', 'Xanh Mint')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#90EE90" title="Xanh Mint" data-color="#90EE90" data-name="Xanh Mint"></button>
                <button type="button" onclick="toggleColor('#008080', 'Xanh Teal')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#008080" title="Xanh Teal" data-color="#008080" data-name="Xanh Teal"></button>
                <button type="button" onclick="toggleColor('#4B0082', 'Tím Indigo')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#4B0082" title="Tím Indigo" data-color="#4B0082" data-name="Tím Indigo"></button>
                <button type="button" onclick="toggleColor('#800080', 'Tím')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#800080" title="Tím" data-color="#800080" data-name="Tím"></button>
                <button type="button" onclick="toggleColor('#E6E6FA', 'Lavender')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#E6E6FA" title="Lavender" data-color="#E6E6FA" data-name="Lavender"></button>
                <!-- Màu titan/điện thoại -->
                <button type="button" onclick="toggleColor('#3C3C3C', 'Titan Tự Nhiên')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#3C3C3C" title="Titan Tự Nhiên" data-color="#3C3C3C" data-name="Titan Tự Nhiên"></button>
                <button type="button" onclick="toggleColor('#F5F5DC', 'Titan Trắng')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#F5F5DC" title="Titan Trắng" data-color="#F5F5DC" data-name="Titan Trắng"></button>
                <button type="button" onclick="toggleColor('#3B4B59', 'Titan Xanh')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#3B4B59" title="Titan Xanh" data-color="#3B4B59" data-name="Titan Xanh"></button>
                <button type="button" onclick="toggleColor('#1C1C1C', 'Titan Đen')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#1C1C1C" title="Titan Đen" data-color="#1C1C1C" data-name="Titan Đen"></button>
                <button type="button" onclick="toggleColor('#2D2926', 'Graphite')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#2D2926" title="Graphite" data-color="#2D2926" data-name="Graphite"></button>
                <button type="button" onclick="toggleColor('#FAF0E6', 'Cream')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#FAF0E6" title="Cream" data-color="#FAF0E6" data-name="Cream"></button>
                <button type="button" onclick="toggleColor('#8B4513', 'Nâu')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#8B4513" title="Nâu" data-color="#8B4513" data-name="Nâu"></button>
                <button type="button" onclick="toggleColor('#800000', 'Đỏ Đô')" class="color-btn w-8 h-8 rounded-lg border-2 border-slate-300 hover:scale-110 transition" style="background:#800000" title="Đỏ Đô" data-color="#800000" data-name="Đỏ Đô"></button>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-hdd text-cyan-500 mr-1"></i>
                Bộ nhớ (GB)
              </label>
              <select id="product-storage" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="64">64GB</option>
                <option value="128" selected>128GB</option>
                <option value="256">256GB</option>
                <option value="512">512GB</option>
                <option value="1024">1TB</option>
              </select>
            </div>
          </div>
          <div class="mt-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-align-left text-slate-500 mr-1"></i>
              Mô tả ngắn
            </label>
            <textarea id="product-description" rows="3" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all resize-none" placeholder="Mô tả ngắn về sản phẩm..."></textarea>
          </div>
          <div class="mt-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-image text-rose-500 mr-1"></i>
              Ảnh đại diện
            </label>
            <input type="hidden" id="product-image">
            <div class="flex items-center gap-4">
              <div id="image-preview" class="w-28 h-28 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center bg-slate-50 overflow-hidden">
                <i class="fas fa-image text-slate-300 text-3xl" id="image-placeholder"></i>
                <img id="preview-img" src="" class="w-full h-full object-cover hidden">
              </div>
              <div class="flex-1">
                <label class="cursor-pointer inline-flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-violet-100 to-purple-100 hover:from-violet-200 hover:to-purple-200 text-violet-700 rounded-xl font-semibold transition-all">
                  <i class="fas fa-upload"></i>
                  <span>Chọn Ảnh</span>
                  <input type="file" id="product-image-file" accept="image/*" class="hidden" onchange="previewImage(this)">
                </label>
                <p class="text-xs text-dark-400 mt-2">Chọn file Ảnh từ máy tính (JPG, PNG, WEBP)</p>
              </div>
            </div>
          </div>
          
          <!-- Ảnh mô tả Sản phẩm -->
          <div class="mt-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-images text-blue-500 mr-1"></i>
              Ảnh mô tả Sản phẩm 
              <span class="text-xs text-dark-400 font-normal">(Tối đa 5 Ảnh)</span>
            </label>
            <div class="border-2 border-dashed border-slate-300 rounded-2xl p-4 bg-slate-50">
              <!-- Preview grid -->
              <div id="gallery-preview" class="grid grid-cols-5 gap-3 mb-3">
                <!-- Ảnh sẽ được thêm vào đây -->
              </div>
              <!-- Upload button -->
              <div class="flex items-center gap-3">
                <label id="add-gallery-btn" class="cursor-pointer inline-flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-blue-100 to-cyan-100 hover:from-blue-200 hover:to-cyan-200 text-blue-700 rounded-xl font-semibold transition-all">
                  <i class="fas fa-plus"></i>
                  <span>Thêm Ảnh mô tả</span>
                  <input type="file" id="gallery-image-file" accept="image/*" multiple class="hidden" onchange="addGalleryImages(this)">
                </label>
                <span class="text-xs text-dark-500 bg-slate-200 px-3 py-1 rounded-full">(<span id="gallery-count">0</span>/5 Ảnh)</span>
                <button type="button" onclick="clearGalleryImages()" class="text-xs text-rose-500 hover:text-rose-700 ml-auto flex items-center gap-1 px-3 py-1 rounded-full hover:bg-rose-50 transition-all">
                  <i class="fas fa-trash"></i>Xóa tất cả
                </button>
              </div>
            </div>
          </div>
          
          <div class="flex gap-3 justify-end pt-6 mt-6 border-t border-slate-200">
            <button type="button" onclick="closeProductModal()" class="px-6 py-3 border-2 border-slate-200 rounded-xl text-dark-600 hover:bg-slate-50 font-semibold transition-all">Hủy</button>
            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex items-center gap-2">
              <span id="product-submit-text">Tiếp tục</span>
              <i class="fas fa-arrow-right" id="product-submit-icon"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Config Modal - Enhanced Design -->
  <div id="config-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white/95 backdrop-blur-sm p-6 border-b border-slate-200 rounded-t-3xl z-10">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-dark-800">Thông số kỹ thuật</h3>
            <p class="text-sm text-dark-400 mt-1" id="config-product-name">Sản phẩm: ...</p>
          </div>
          <div class="flex items-center gap-2 text-sm bg-emerald-50 text-emerald-700 px-4 py-2 rounded-full font-medium">
            <span class="w-6 h-6 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white flex items-center justify-center text-xs font-bold">2</span>
            <span>Cấu hình chi tiết</span>
          </div>
        </div>
      </div>
      <div class="p-6">
        <form id="config-form">
          <input type="hidden" id="config-product-id">
          
          <!-- Thông báo -->
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-5 mb-6">
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center flex-shrink-0">
                <i class="fas fa-info-circle text-blue-500"></i>
              </div>
              <div class="text-sm text-blue-800">
                <p class="font-semibold">Nhập Thông số kỹ thuật chi tiết</p>
                <p class="mt-1 text-blue-600">Thông số này sẽ hiển thị ở trang chi tiết Sản phẩm. Bạn có thể bỏ qua bước này và thêm sau.</p>
              </div>
            </div>
          </div>
          
          <!-- Nút gợi ý tự động -->
          <div class="mb-6">
            <button type="button" onclick="autoFillSpecs()" class="w-full py-4 bg-gradient-to-r from-violet-500 via-purple-500 to-fuchsia-500 hover:from-violet-600 hover:via-purple-600 hover:to-fuchsia-600 text-white rounded-2xl font-semibold flex items-center justify-center gap-3 transition-all shadow-lg shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30 hover:-translate-y-0.5">
              <i class="fas fa-magic text-lg"></i>
              <span>Tự động điền thông số theo hãng</span>
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-memory text-violet-500 mr-1"></i>RAM
              </label>
              <select id="config-ram" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn RAM</option>
                <option value="4GB">4GB</option>
                <option value="6GB">6GB</option>
                <option value="8GB">8GB</option>
                <option value="12GB">12GB</option>
                <option value="16GB">16GB</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-microchip text-violet-500 mr-1"></i>Chip / CPU
              </label>
              <select id="config-chip" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn Chip</option>
                <optgroup label="Apple">
                  <option value="Apple A18 Pro">Apple A18 Pro</option>
                  <option value="Apple A18">Apple A18</option>
                  <option value="Apple A17 Pro">Apple A17 Pro</option>
                  <option value="Apple A16 Bionic">Apple A16 Bionic</option>
                  <option value="Apple A15 Bionic">Apple A15 Bionic</option>
                </optgroup>
                <optgroup label="Qualcomm">
                  <option value="Snapdragon 8 Elite">Snapdragon 8 Elite</option>
                  <option value="Snapdragon 8 Gen 3">Snapdragon 8 Gen 3</option>
                  <option value="Snapdragon 8 Gen 2">Snapdragon 8 Gen 2</option>
                  <option value="Snapdragon 7+ Gen 3">Snapdragon 7+ Gen 3</option>
                  <option value="Snapdragon 6 Gen 1">Snapdragon 6 Gen 1</option>
                </optgroup>
                <optgroup label="Samsung">
                  <option value="Exynos 2400">Exynos 2400</option>
                  <option value="Exynos 2200">Exynos 2200</option>
                  <option value="Exynos 1480">Exynos 1480</option>
                </optgroup>
                <optgroup label="MediaTek">
                  <option value="Dimensity 9300">Dimensity 9300</option>
                  <option value="Dimensity 8300">Dimensity 8300</option>
                  <option value="Dimensity 7300">Dimensity 7300</option>
                  <option value="Helio G99">Helio G99</option>
                </optgroup>
                <optgroup label="Google">
                  <option value="Google Tensor G4">Google Tensor G4</option>
                  <option value="Google Tensor G3">Google Tensor G3</option>
                </optgroup>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-mobile-alt text-violet-500 mr-1"></i>Màn hình
              </label>
              <select id="config-screen" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn Màn hình</option>
                <optgroup label="6.1 inch">
                  <option value='6.1" Super Retina XDR, 2556x1179, 120Hz'>6.1" Super Retina XDR, 120Hz (iPhone)</option>
                  <option value='6.1" Dynamic AMOLED 2X, 2340x1080, 120Hz'>6.1" Dynamic AMOLED 2X, 120Hz (Samsung)</option>
                </optgroup>
                <optgroup label="6.7 - 6.9 inch">
                  <option value='6.7" Super Retina XDR, 2796x1290, 120Hz'>6.7" Super Retina XDR, 120Hz (iPhone Pro Max)</option>
                  <option value='6.8" Dynamic AMOLED 2X, 3120x1440, 120Hz'>6.8" Dynamic AMOLED 2X, 120Hz (Samsung Ultra)</option>
                  <option value='6.73" AMOLED, 3200x1440, 120Hz'>6.73" AMOLED, 3200x1440, 120Hz (Xiaomi)</option>
                  <option value='6.7" LTPO AMOLED, 2992x1344, 120Hz'>6.7" LTPO AMOLED, 120Hz (Google Pixel)</option>
                  <option value='6.7" AMOLED, 2780x1264, 120Hz'>6.7" AMOLED, 120Hz (OPPO)</option>
                </optgroup>
                <optgroup label="6.5 inch">
                  <option value='6.5" Super AMOLED, 2340x1080, 120Hz'>6.5" Super AMOLED, 120Hz</option>
                  <option value='6.5" IPS LCD, 2400x1080, 90Hz'>6.5" IPS LCD, 90Hz</option>
                </optgroup>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-camera text-violet-500 mr-1"></i>Camera
              </label>
              <select id="config-camera" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn camera</option>
                <optgroup label="Camera cao cap">
                  <option value="200MP + 50MP + 12MP + 10MP">200MP + 50MP + 12MP + 10MP (Samsung Ultra)</option>
                  <option value="48MP + 12MP + 12MP (ProRAW, 5x Zoom)">48MP + 12MP + 12MP, 5x Zoom (iPhone Pro Max)</option>
                  <option value="48MP + 12MP + 12MP">48MP + 12MP + 12MP (iPhone Pro)</option>
                  <option value="50MP + 50MP + 48MP">50MP + 50MP + 48MP (Google Pixel Pro)</option>
                </optgroup>
                <optgroup label="Camera tam trung">
                  <option value="50MP + 12MP + 10MP">50MP + 12MP + 10MP</option>
                  <option value="50MP + 12MP + 5MP">50MP + 12MP + 5MP</option>
                  <option value="50MP + 8MP + 2MP">50MP + 8MP + 2MP</option>
                  <option value="108MP + 8MP + 2MP">108MP + 8MP + 2MP (Xiaomi)</option>
                </optgroup>
                <optgroup label="Camera pho thong">
                  <option value="48MP + 2MP">48MP + 2MP</option>
                  <option value="50MP + 2MP">50MP + 2MP</option>
                  <option value="13MP + 2MP">13MP + 2MP</option>
                </optgroup>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fas fa-battery-full text-violet-500 mr-1"></i>Pin
              </label>
              <select id="config-battery" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn pin</option>
                <optgroup label="Pin lon (5000mAh+)">
                  <option value="5000mAh, sac nhanh 45W">5000mAh, sac nhanh 45W (Samsung)</option>
                  <option value="5000mAh, sac nhanh 120W">5000mAh, sac nhanh 120W (Xiaomi)</option>
                  <option value="5400mAh, sac nhanh 80W">5400mAh, sac nhanh 80W (OPPO)</option>
                  <option value="5050mAh, sac nhanh 37W">5050mAh, sac nhanh 37W (Google Pixel)</option>
                </optgroup>
                <optgroup label="Pin vua (4500-4999mAh)">
                  <option value="4685mAh, sac nhanh 27W, MagSafe 25W">4685mAh, sac 27W, MagSafe (iPhone Pro Max)</option>
                  <option value="4500mAh, sac nhanh 25W">4500mAh, sac nhanh 25W</option>
                  <option value="4700mAh, sac nhanh 67W">4700mAh, sac nhanh 67W</option>
                </optgroup>
                <optgroup label="Pin nho (<4500mAh)">
                  <option value="3561mAh, sac nhanh 20W, MagSafe 15W">3561mAh, sac 20W (iPhone 16)</option>
                  <option value="4000mAh, sac nhanh 25W">4000mAh, sac nhanh 25W</option>
                  <option value="3800mAh, sac nhanh 18W">3800mAh, sac nhanh 18W</option>
                </optgroup>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-dark-700 mb-2">
                <i class="fab fa-android text-emerald-500 mr-1"></i>Hệ điều hành
              </label>
              <select id="config-os" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
                <option value="">Chọn Hệ điều hành</option>
                <optgroup label="iOS">
                  <option value="iOS 18">iOS 18</option>
                  <option value="iOS 17">iOS 17</option>
                  <option value="iOS 16">iOS 16</option>
                </optgroup>
                <optgroup label="Android">
                  <option value="Android 15">Android 15</option>
                  <option value="Android 14">Android 14</option>
                  <option value="Android 14, One UI 6.1">Android 14, One UI 6.1 (Samsung)</option>
                  <option value="Android 14, HyperOS">Android 14, HyperOS (Xiaomi)</option>
                  <option value="Android 14, ColorOS 14">Android 14, ColorOS 14 (OPPO)</option>
                  <option value="Android 14, Funtouch OS">Android 14, Funtouch OS (Vivo)</option>
                </optgroup>
                <optgroup label="Khac">
                  <option value="HarmonyOS 4.0">HarmonyOS 4.0</option>
                </optgroup>
              </select>
            </div>
          </div>
          
          <div class="flex gap-3 justify-between pt-6 mt-6 border-t border-slate-200">
            <button type="button" onclick="skipConfig()" class="px-6 py-3 text-dark-500 hover:text-dark-700 font-semibold flex items-center gap-2 hover:bg-slate-100 rounded-xl transition-all">
              <i class="fas fa-forward"></i>Bỏ qua
            </button>
            <div class="flex gap-3">
              <button type="button" onclick="backToProductModal()" class="px-6 py-3 border-2 border-slate-200 rounded-xl text-dark-600 hover:bg-slate-50 font-semibold flex items-center gap-2 transition-all">
                <i class="fas fa-arrow-left"></i>Quay lỗi
              </button>
              <button type="submit" class="px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white rounded-xl font-semibold flex items-center gap-2 shadow-lg shadow-emerald-500/25 transition-all">
                <i class="fas fa-check"></i>Hoàn tất
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- News Modal - Enhanced Design -->
  <div id="news-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white/95 backdrop-blur-sm p-6 border-b border-slate-200 rounded-t-3xl z-10 flex items-center justify-between">
        <div>
          <h3 class="text-xl font-bold text-dark-800" id="news-modal-title">Thêm Tin tức mới</h3>
          <p class="text-sm text-dark-400 mt-1">Tạo bài viết Tin tức mới</p>
        </div>
        <button onclick="closeNewsModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-dark-400 hover:text-dark-600 transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="p-6">
        <form id="news-form">
          <input type="hidden" id="news-id">
          <input type="hidden" id="news-image">
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-heading text-primary-500 mr-1"></i>
              Tiêu đề <span class="text-rose-500">*</span>
            </label>
            <input type="text" id="news-title" required class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="Nhập tiêu đề tin tức">
          </div>
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-file-alt text-primary-500 mr-1"></i>
              Nội dung <span class="text-rose-500">*</span>
            </label>
            <textarea id="news-content" required rows="8" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all resize-none" placeholder="Nhập nội dung tin tức"></textarea>
          </div>
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-image text-rose-500 mr-1"></i>
              Ảnh đại diện
            </label>
            <div class="flex items-center gap-4">
              <div id="news-image-preview" class="w-28 h-28 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center bg-slate-50 overflow-hidden">
                <i class="fas fa-image text-slate-300 text-3xl" id="news-image-placeholder"></i>
                <img id="news-preview-img" src="" class="w-full h-full object-cover hidden">
              </div>
              <div class="flex-1">
                <label class="cursor-pointer inline-flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-violet-100 to-purple-100 hover:from-violet-200 hover:to-purple-200 text-violet-700 rounded-xl font-semibold transition-all">
                  <i class="fas fa-upload"></i>
                  <span>Chọn Ảnh</span>
                  <input type="file" id="news-image-file" accept="image/*" class="hidden" onchange="previewNewsImage(this)">
                </label>
                <p class="text-xs text-dark-400 mt-2">Chọn file Ảnh từ máy tính (JPG, PNG, WEBP)</p>
              </div>
            </div>
          </div>
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-video text-blue-500 mr-1"></i>
              URL Video (YouTube, Vimeo,...)
            </label>
            <input type="text" id="news-video" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" placeholder="https://www.youtube.com/watch?v=xxxxx">
            <p class="text-xs text-dark-400 mt-1">Để trống nếu không có video. Hỗ trợ YouTube, Vimeo, hoặc link video trực tiếp.</p>
          </div>
          <div class="flex gap-3 justify-end pt-4 border-t border-slate-200">
            <button type="button" onclick="closeNewsModal()" class="px-6 py-3 border-2 border-slate-200 rounded-xl text-dark-600 hover:bg-slate-50 font-semibold transition-all">Hủy</button>
            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold">Lưu</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- News Detail Modal - Xem chi tiết Tin tức -->
  <div id="news-detail-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white/95 backdrop-blur-sm p-6 border-b border-slate-200 rounded-t-3xl z-10 flex items-center justify-between">
        <div>
          <h3 class="text-xl font-bold text-dark-800">Chi tiết Tin tức</h3>
          <p class="text-sm text-dark-400 mt-1">Xem thông tin bài viết</p>
        </div>
        <button onclick="closeNewsDetailModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-dark-400 hover:text-dark-600 transition-colors">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="p-6" id="news-detail-content">
        <!-- Nội dung sẽ được render bằng JS -->
      </div>
    </div>
  </div>
  
  <!-- Brand Modal - Enhanced Design -->
  <div id="brand-modal" class="fixed inset-0 bg-dark-950/70 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b border-slate-200 rounded-t-3xl">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold text-dark-800" id="brand-modal-title">Thêm Hãng mới</h3>
            <p class="text-sm text-dark-400 mt-1">Thêm thương hiệu sản xuất</p>
          </div>
          <button onclick="closeBrandModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-dark-400 hover:text-dark-600 transition-colors">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <div class="p-6">
        <form id="brand-form">
          <input type="hidden" id="brand-id">
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-tag text-violet-500 mr-1"></i>
              Tên Hãng <span class="text-rose-500">*</span>
            </label>
            <input type="text" id="brand-name" required 
              class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all" 
              placeholder="VD: Apple, Samsung, Xiaomi...">
          </div>
          <div class="mb-5">
            <label class="block text-sm font-semibold text-dark-700 mb-2">
              <i class="fas fa-globe text-blue-500 mr-1"></i>
              quốc gia
            </label>
            <select id="brand-country" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all bg-white">
              <option value="">-- Chọn quốc gia --</option>
            </select>
            <p class="text-xs text-dark-400 mt-1">Quốc gia xuất xứ của hãng</p>
          </div>
          <div class="flex gap-3 justify-end pt-4 border-t border-slate-200">
            <button type="button" onclick="closeBrandModal()" class="px-6 py-3 border-2 border-slate-200 rounded-xl text-dark-600 hover:bg-slate-50 font-semibold transition-all">Hủy</button>
            <button type="submit" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex items-center gap-2">
              <i class="fas fa-save"></i>Lưu
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    const API_URL = 'http://localhost:3000/api';
    const PLACEHOLDER_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTJlOGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
    let allOrders = [], allProducts = [], allCustomers = [], allReviews = [], allContacts = [];
    let selectedImageFile = null; // Luu file anh duoc chon
    
    // Cau hinh mac dinh theo hang
    const brandSpecs = {
      'Apple': {
        ram: '8GB',
        chip: 'Apple A18 Pro',
        screen: '6.7" Super Retina XDR, 2796x1290, 120Hz',
        camera: '48MP + 12MP + 12MP (ProRAW, 5x Zoom)',
        battery: '4685mAh, sac nhanh 27W, MagSafe 25W',
        os: 'iOS 18'
      },
      'Samsung': {
        ram: '12GB',
        chip: 'Snapdragon 8 Gen 3',
        screen: '6.8" Dynamic AMOLED 2X, 3120x1440, 120Hz',
        camera: '200MP + 50MP + 12MP + 10MP',
        battery: '5000mAh, sac nhanh 45W',
        os: 'Android 14, One UI 6.1'
      },
      'Xiaomi': {
        ram: '12GB',
        chip: 'Snapdragon 8 Gen 3',
        screen: '6.73" AMOLED, 3200x1440, 120Hz',
        camera: '108MP + 8MP + 2MP',
        battery: '5000mAh, sac nhanh 120W',
        os: 'Android 14, HyperOS'
      },
      'OPPO': {
        ram: '12GB',
        chip: 'Dimensity 9300',
        screen: '6.7" AMOLED, 2780x1264, 120Hz',
        camera: '50MP + 8MP + 2MP',
        battery: '5400mAh, sac nhanh 80W',
        os: 'Android 14, ColorOS 14'
      },
      'Google': {
        ram: '12GB',
        chip: 'Google Tensor G4',
        screen: '6.7" LTPO AMOLED, 2992x1344, 120Hz',
        camera: '50MP + 50MP + 48MP',
        battery: '5050mAh, sac nhanh 37W',
        os: 'Android 15'
      },
      'Vivo': {
        ram: '12GB',
        chip: 'Snapdragon 8 Gen 2',
        screen: '6.7" AMOLED, 2780x1264, 120Hz',
        camera: '50MP + 12MP + 5MP',
        battery: '4700mAh, sac nhanh 67W',
        os: 'Android 14, Funtouch OS'
      },
      'Realme': {
        ram: '8GB',
        chip: 'Dimensity 7300',
        screen: '6.5" Super AMOLED, 2340x1080, 120Hz',
        camera: '50MP + 8MP + 2MP',
        battery: '5000mAh, sac nhanh 120W',
        os: 'Android 14'
      },
      'Huawei': {
        ram: '12GB',
        chip: 'Kirin 9000s',
        screen: '6.7" LTPO OLED, 2848x1224, 120Hz',
        camera: '50MP + 12MP + 12MP',
        battery: '5000mAh, sac nhanh 88W',
        os: 'HarmonyOS 4.0'
      }
    };
    
    // ===== COLOR PICKER FUNCTIONS =====
    var selectedColors = []; // [{hex: '#000000', name: 'Đen'}, ...]
    
    function toggleColor(hex, name) {
      const index = selectedColors.findIndex(c => c.hex === hex);
      if (index > -1) {
        // Bỏ chọn màu
        selectedColors.splice(index, 1);
      } else {
        // Thêm màu
        selectedColors.push({hex: hex, name: name});
      }
      updateColorDisplay();
    }
    
    // Thêm màu tùy chỉnh từ color picker
    function addCustomColor() {
      const colorPicker = document.getElementById('custom-color-picker');
      const colorNameInput = document.getElementById('custom-color-name');
      const hex = colorPicker.value.toUpperCase();
      const name = colorNameInput.value.trim();
      
      if (!name) {
        showToast('Vui lòng nhập tên màu!', 'error');
        colorNameInput.focus();
        return;
      }
      
      // Kiểm tra màu đã tồn tại chưa
      if (selectedColors.find(c => c.hex.toUpperCase() === hex)) {
        showToast('Màu này đã được chọn!', 'error');
        return;
      }
      
      // Thêm màu mới
      selectedColors.push({ hex: hex, name: name });
      updateColorDisplay();
      
      // Reset input
      colorNameInput.value = '';
      showToast('Đã thêm màu: ' + name);
    }
    
    function updateColorDisplay() {
      const container = document.getElementById('selected-colors');
      const colorInput = document.getElementById('product-color');
      const colorNamesInput = document.getElementById('product-color-names');
      
      // Update button states trong bảng màu
      document.querySelectorAll('.color-btn').forEach(btn => {
        const color = btn.getAttribute('data-color');
        if (selectedColors.find(c => c.hex.toUpperCase() === color.toUpperCase())) {
          btn.classList.add('ring-2', 'ring-violet-500', 'ring-offset-1');
        } else {
          btn.classList.remove('ring-2', 'ring-violet-500', 'ring-offset-1');
        }
      });
      
      if (selectedColors.length === 0) {
        container.innerHTML = '<span class="text-slate-400 text-sm" id="color-placeholder">Chưa chọn màu nào...</span>';
        colorInput.value = '';
        colorNamesInput.value = '';
      } else {
        container.innerHTML = selectedColors.map(c => 
          '<span class="inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-white border border-slate-200 rounded-lg text-sm shadow-sm">' +
          '<span class="w-5 h-5 rounded-full border border-slate-300 shadow-inner" style="background:' + c.hex + '"></span>' +
          '<span class="font-medium">' + c.name + '</span>' +
          '<button type="button" onclick="removeColor(\'' + c.hex + '\')" class="text-slate-400 hover:text-red-500 ml-1 text-lg leading-none">&times;</button>' +
          '</span>'
        ).join('');
        // Lưu vào hidden input: mảng hex và mảng tên
        colorInput.value = JSON.stringify(selectedColors.map(c => c.hex));
        colorNamesInput.value = JSON.stringify(selectedColors.map(c => c.name));
      }
    }
    
    function removeColor(hex) {
      selectedColors = selectedColors.filter(c => c.hex.toUpperCase() !== hex.toUpperCase());
      updateColorDisplay();
    }
    
    function resetColorPicker() {
      selectedColors = [];
      updateColorDisplay();
    }
    
    function loadColorsFromData(colorsJson, colorNamesJson) {
      selectedColors = [];
      try {
        const colors = typeof colorsJson === 'string' ? JSON.parse(colorsJson) : (colorsJson || []);
        const names = typeof colorNamesJson === 'string' ? JSON.parse(colorNamesJson) : (colorNamesJson || []);
        for (let i = 0; i < colors.length; i++) {
          selectedColors.push({
            hex: colors[i],
            name: names[i] || colors[i]
          });
        }
      } catch(e) {
        console.log('Error parsing colors:', e);
      }
      updateColorDisplay();
    }
    
    // Preview anh khi chon file
    function previewImage(input) {
      if (input.files && input.files[0]) {
        selectedImageFile = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('preview-img').src = e.target.result;
          document.getElementById('preview-img').classList.remove('hidden');
          document.getElementById('image-placeholder').classList.add('hidden');
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    
    // ===== GALLERY IMAGES FUNCTIONS =====
    var galleryImageFiles = []; // Lưu các file Ảnh mô tả
    
    function addGalleryImages(input) {
      if (input.files && input.files.length > 0) {
        const maxImages = 5;
        const currentCount = galleryImageFiles.length;
        const remainingSlots = maxImages - currentCount;
        
        if (remainingSlots <= 0) {
          showToast('Đã đạt Tối đa 5 Ảnh mô tả!', 'error');
          return;
        }
        
        // Chỉ lấy số Ảnh còn được phép thêm
        const filesToAdd = Array.from(input.files).slice(0, remainingSlots);
        
        filesToAdd.forEach(file => {
          const reader = new FileReader();
          reader.onload = function(e) {
            galleryImageFiles.push({
              file: file,
              dataUrl: e.target.result
            });
            renderGalleryPreview();
          };
          reader.readAsDataURL(file);
        });
        
        // Reset input để có thể chọn lại cùng file
        input.value = '';
      }
    }
    
    function renderGalleryPreview() {
      const container = document.getElementById('gallery-preview');
      const countEl = document.getElementById('gallery-count');
      
      countEl.textContent = galleryImageFiles.length;
      
      if (galleryImageFiles.length === 0) {
        container.innerHTML = '<p class="text-slate-400 text-sm col-span-5 text-center py-4">Chưa có Ảnh mô tả nào</p>';
        return;
      }
      
      container.innerHTML = galleryImageFiles.map((img, index) => `
        <div class="relative group">
          <img src="${img.dataUrl}" class="w-full h-20 object-cover rounded-lg border border-slate-200">
          <button type="button" onclick="removeGalleryImage(${index})" 
            class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
            <i class="fas fa-times"></i>
          </button>
          <span class="absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1 rounded">${index + 1}</span>
        </div>
      `).join('');
    }
    
    function removeGalleryImage(index) {
      galleryImageFiles.splice(index, 1);
      renderGalleryPreview();
    }
    
    function clearGalleryImages() {
      galleryImageFiles = [];
      renderGalleryPreview();
    }
    
    function resetGalleryImages() {
      galleryImageFiles = [];
      document.getElementById('gallery-image-file').value = '';
      renderGalleryPreview();
    }
    
    // Reset preview anh
    function resetImagePreview() {
      document.getElementById('preview-img').src = '';
      document.getElementById('preview-img').classList.add('hidden');
      document.getElementById('image-placeholder').classList.remove('hidden');
      document.getElementById('product-image-file').value = '';
      document.getElementById('product-image').value = '';
      selectedImageFile = null;
      resetColorPicker(); // Reset colors khi mở modal mới
      resetGalleryImages(); // Reset gallery images
    }
    
    // Tu dong dien thong so theo hang
    function autoFillSpecs() {
      // Lay ten hang tu san pham
      const productName = configProductName.toLowerCase();
      let brandName = '';
      
      // Xac dinh hang dua tren ten san pham hoac brand ID
      for (const brand of Object.keys(brandSpecs)) {
        if (productName.includes(brand.toLowerCase())) {
          brandName = brand;
          break;
        }
      }
      
      // Neu khong tim thay, thu lay tu allBrands
      if (!brandName && configProductId) {
        const product = allProducts.find(p => (p.ma_sp || p.id) === configProductId);
        if (product && product.ma_hang) {
          const brand = allBrands.find(b => b.ma_hang === product.ma_hang);
          if (brand) brandName = brand.ten_hang;
        }
      }
      
      if (brandName && brandSpecs[brandName]) {
        const specs = brandSpecs[brandName];
        document.getElementById('config-ram').value = specs.ram;
        document.getElementById('config-chip').value = specs.chip;
        document.getElementById('config-screen').value = specs.screen;
        document.getElementById('config-camera').value = specs.camera;
        document.getElementById('config-battery').value = specs.battery;
        document.getElementById('config-os').value = specs.os;
        showToast('Đã tự động điền thông số ' + brandName);
      } else {
        showToast('Không tìm thấy gợi ý cho hãng này. Vui lòng chọn thủ công.', 'error');
      }
    }
    
    document.addEventListener('DOMContentLoaded', () => { 
      document.getElementById('current-date').textContent = new Date().toLocaleDateString('vi-VN'); 
      loadAdminInfo();
      loadBrands();
      loadDashboardData();
      loadContactStats();
    });
    
    // Load admin info from localStorage and then refresh from database
    async function loadAdminInfo() {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const isAdmin = localStorage.getItem('isAdmin') === 'true';
      
      // Kiểm tra quyền admin (hỗ trợ cả Google login và normal login)
      if (!isAdmin && !user.isAdmin && user.role !== 'admin') {
        alert('Bạn không có quyền truy cập trang này!');
        window.location.href = 'admin-login.html';
        return;
      }
      
      // Hiển thị thông tin từ localStorage trước (để nhanh)
      displayAdminInfo(user);
      
      // Nếu có ma_admin, load lại từ database
      if (user.ma_admin) {
        try {
          const res = await fetch(API_URL + '/admin/profile/' + user.ma_admin);
          const data = await res.json();
          
          if (data.success && data.data) {
            // Merge dữ liệu từ DB với dữ liệu hiện tại (giữ lại avatar từ Google nếu có)
            const updatedUser = { 
              ...user, 
              ...data.data,
              avt: data.data.avt || user.avt // Ưu tiên avatar từ DB, nếu không có thì dùng từ Google
            };
            localStorage.setItem('user', JSON.stringify(updatedUser));
            
            // Hiển thị thông tin mới từ database
            displayAdminInfo(updatedUser);
          }
        } catch (e) {
          console.error('Error loading admin info from DB:', e);
          // Vẫn hiển thị từ localStorage nếu lỗi API
        }
      }
    }
    
    // Hàm hiển thị thông tin admin lên giao diện
    function displayAdminInfo(admin) {
      const adminName = admin.ho_ten || admin.ten_admin || 'Admin';
      const adminAvatar = admin.avt || admin.avatar || '';
      const adminRole = admin.quyen === 'superadmin' ? 'Super Admin' : 'Quản trị viên';
      
      // Cập nhật tên admin
      document.getElementById('admin-name').textContent = adminName;
      document.getElementById('welcome-text').textContent = 'Chào mừng trở lại, ' + adminName + '!';
      
      // Cập nhật avatar
      const avatarElement = document.getElementById('admin-avatar');
      if (adminAvatar) {
        const firstChar = adminName.charAt(0).toUpperCase();
        avatarElement.innerHTML = '<img src="' + adminAvatar + '" alt="Avatar" class="w-full h-full object-cover rounded-full" onerror="this.style.display=\'none\'; this.parentElement.textContent=\'' + firstChar + '\'">';
      } else {
        avatarElement.textContent = adminName.charAt(0).toUpperCase();
      }
      
      // Cập nhật role
      document.getElementById('admin-role').textContent = adminRole;
    }
    function logout() { 
      localStorage.removeItem('user'); 
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('isAdmin');
      window.location.href = 'login.html'; 
    }
    function showSection(section) {
      document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.sidebar-item').forEach(el => { el.classList.remove('active', 'text-white'); el.classList.add('text-slate-300'); });
      document.getElementById('section-' + section).classList.add('active');
      const navItem = document.getElementById('nav-' + section);
      if (navItem) { navItem.classList.add('active', 'text-white'); navItem.classList.remove('text-slate-300'); }
      const titles = { dashboard: 'Tổng quan', orders: 'Quản lý đơn hàng', products: 'Quản lý Sản phẩm', customers: 'Quản lý Khách hàng', news: 'Quản lý Tin tức', reviews: 'Quản lý đánh giá', brands: 'Quản lý hãng sản xuất', contacts: 'Quản lý liên hệ', promotions: 'Quản lý Khuyến mãi', notifications: 'Gửi thông báo' };
      document.getElementById('page-title').textContent = titles[section] || 'Tổng quan';
      if (section === 'dashboard') loadDashboardData();
      else if (section === 'orders') loadOrders();
      else if (section === 'products') loadProducts();
      else if (section === 'customers') loadCustomers();
      else if (section === 'news') loadNews();
      else if (section === 'reviews') loadReviews();
      else if (section === 'brands') loadBrandsSection();
      else if (section === 'contacts') loadContacts();
      else if (section === 'promotions') loadPromotions();
      else if (section === 'notifications') loadNotificationSection();
    }
    async function loadDashboardData() {
      let products = [], ordersData = [], customersData = [], topProducts = [];
      try { products = await fetch(API_URL + '/products').then(r => r.json()); } catch(e) { products = []; }
      try { const orders = await fetch(API_URL + '/admin/orders').then(r => r.json()); ordersData = orders.data || orders || []; } catch(e) { ordersData = []; }
      try { const customers = await fetch(API_URL + '/admin/customers').then(r => r.json()); customersData = customers.data || customers || []; } catch(e) { customersData = []; }
      try { const topRes = await fetch(API_URL + '/admin/stats/top-products'); const topData = await topRes.json(); topProducts = topData.data || topData || []; } catch(e) { topProducts = []; }
      
      // Tính doanh thu từ đơn hàng không bị hủy
      const validOrders = ordersData.filter(o => o.trang_thai !== 'cancelled');
      const revenue = validOrders.reduce((sum, o) => sum + parseFloat(o.tong_tien || 0), 0);
      const pendingOrders = ordersData.filter(o => o.trang_thai === 'pending').length;
      
      // Tính tổng số lượng Sản phẩm đã bán
      const totalSold = topProducts.reduce((sum, p) => sum + parseInt(p.total_sold || 0), 0);
      
      document.getElementById('stat-revenue').textContent = formatCurrency(revenue);
      document.getElementById('stat-orders').textContent = ordersData.length;
      document.getElementById('stat-customers').textContent = customersData.length;
      document.getElementById('stat-products').textContent = totalSold;
      document.getElementById('pending-count').textContent = pendingOrders;
      
      renderRecentOrders(ordersData.slice(0, 5));
      renderTopProducts(topProducts.slice(0, 5));
      initRevenueChart(ordersData);
      initOrdersChart(ordersData);
    }
    
    // Render top Sản phẩm bán chạy
    function renderTopProducts(products) {
      const container = document.getElementById('top-products-list');
      if (!container) return;
      
      if (!products.length) {
        container.innerHTML = '<div class="text-center py-8 text-slate-400"><i class="fas fa-box-open text-4xl mb-3"></i><p>Chưa có dữ liệu bán hàng</p></div>';
        return;
      }
      
      const colors = ['bg-yellow-500', 'bg-slate-400', 'bg-amber-600', 'bg-slate-500', 'bg-slate-500'];
      const badgeColors = ['text-yellow-500', 'text-slate-400', 'text-amber-600', 'text-slate-500', 'text-slate-500'];
      
      container.innerHTML = products.map((p, idx) => {
        const name = p.ten_sp || p.name || 'Sản phẩm';
        const sold = p.total_sold || 0;
        const price = p.gia || p.price || 0;
        const image = p.anh_dai_dien || p.image || PLACEHOLDER_IMAGE;
        const brand = p.ten_hang || 'N/A';
        
        return `
          <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition-colors">
            <div class="relative">
              <span class="absolute -top-1 -left-1 w-5 h-5 ${colors[idx]} rounded-full flex items-center justify-center text-white text-xs font-bold shadow">${idx + 1}</span>
              <img src="${image}" class="w-12 h-12 rounded-xl object-cover" onerror="this.src='${PLACEHOLDER_IMAGE}'">
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-slate-800 truncate text-sm">${name}</p>
              <p class="text-xs text-slate-500">${brand} • ${formatCurrency(price)}</p>
            </div>
            <div class="text-right">
              <span class="font-bold ${badgeColors[idx]}">${sold}</span>
              <p class="text-xs text-slate-400">đã bán</p>
            </div>
          </div>
        `;
      }).join('');
    }
    function renderRecentOrders(orders) {
      const tbody = document.getElementById('recent-orders-table');
      if (!orders.length) { tbody.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-slate-400">Chưa có đơn hàng</td></tr>'; return; }
      tbody.innerHTML = orders.map(o => '<tr class="border-b border-slate-50"><td class="py-4 font-medium text-violet-600">#' + o.ma_don + '</td><td class="py-4">' + (o.ten_nguoi_nhan || 'N/A') + '</td><td class="py-4 font-semibold">' + formatCurrency(o.tong_tien) + '</td><td class="py-4">' + getStatusBadge(o.trang_thai) + '</td><td class="py-4 text-slate-500">' + formatDate(o.thoi_gian) + '</td></tr>').join('');
    }
    function initRevenueChart(orders) {
      const ctx = document.getElementById('revenueChart'); if (!ctx) return;
      const monthlyRevenue = Array(12).fill(0);
      orders.forEach(o => { const m = new Date(o.thoi_gian).getMonth(); if (o.trang_thai !== 'cancelled') monthlyRevenue[m] += parseFloat(o.tong_tien || 0); });
      
      // Kế hoạch doanh thu (giả lập - có thể cập nhật sau)
      const planRevenue = monthlyRevenue.map(r => r > 0 ? r * 1.2 : 50000000);
      
      new Chart(ctx, { 
        type: 'bar', 
        data: { 
          labels: ['T1','T2','T3','T4','T5','T6','T7','T8','T9','T10','T11','T12'], 
          datasets: [
            { 
              label: 'thực tế', 
              data: monthlyRevenue, 
              backgroundColor: 'rgba(59, 130, 246, 0.8)',
              borderColor: '#3b82f6',
              borderWidth: 1,
              borderRadius: 4,
              barPercentage: 0.6
            },
            { 
              label: 'Kế hoạch', 
              data: planRevenue, 
              backgroundColor: 'rgba(203, 213, 225, 0.6)',
              borderColor: '#cbd5e1',
              borderWidth: 1,
              borderRadius: 4,
              barPercentage: 0.6
            }
          ] 
        }, 
        options: { 
          responsive: true, 
          plugins: { 
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + new Intl.NumberFormat('vi-VN').format(context.raw) + 'đ';
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return (value / 1000000) + 'M';
                }
              }
            }
          }
        } 
      });
    }
    function initOrdersChart(orders) {
      const ctx = document.getElementById('ordersChart'); if (!ctx) return;
      const counts = { pending: 0, confirmed: 0, shipping: 0, delivered: 0, cancelled: 0 };
      orders.forEach(o => { if (counts.hasOwnProperty(o.trang_thai)) counts[o.trang_thai]++; });
      new Chart(ctx, { 
        type: 'doughnut', 
        data: { 
          labels: ['Chờ xử lý','Đã xác nhận','Đang giao','Đã giao','Đã hủy'], 
          datasets: [{ 
            data: Object.values(counts), 
            backgroundColor: ['#f59e0b','#3b82f6','#8b5cf6','#10b981','#ef4444'],
            borderWidth: 0,
            hoverOffset: 4
          }] 
        }, 
        options: { 
          responsive: true, 
          cutout: '65%',
          plugins: { 
            legend: { 
              position: 'bottom',
              labels: {
                padding: 15,
                usePointStyle: true,
                pointStyle: 'circle'
              }
            } 
          } 
        } 
      });
    }
    
    // ===================== CHART INSTANCES =====================
    let ordersStatusPieChartInstance = null;
    let ordersWeeklyChartInstance = null;
    let productsByBrandChartInstance = null;
    let productsPriceChartInstance = null;
    let brandsProductsChartInstance = null;
    let brandsByCountryChartInstance = null;
    let customersMonthlyChartInstance = null;
    let customersTopSpendingChartInstance = null;
    let newsMonthlyChartInstance = null;
    let reviewsRatingChartInstance = null;
    let reviewsMonthlyChartInstance = null;
    
    // ===================== ORDERS SECTION CHARTS =====================
    function initOrdersSectionCharts(orders) {
      // Update quick stats
      const pending = orders.filter(o => o.trang_thai === 'pending').length;
      const confirmed = orders.filter(o => o.trang_thai === 'confirmed').length;
      const shipping = orders.filter(o => o.trang_thai === 'shipping').length;
      const delivered = orders.filter(o => o.trang_thai === 'delivered').length;
      
      const pendingEl = document.getElementById('orders-pending-count');
      const confirmedEl = document.getElementById('orders-confirmed-count');
      const shippingEl = document.getElementById('orders-shipping-count');
      const deliveredEl = document.getElementById('orders-delivered-count');
      
      if (pendingEl) pendingEl.textContent = pending;
      if (confirmedEl) confirmedEl.textContent = confirmed;
      if (shippingEl) shippingEl.textContent = shipping;
      if (deliveredEl) deliveredEl.textContent = delivered;
      
      // Status Pie Chart
      const pieCtx = document.getElementById('ordersStatusPieChart');
      if (pieCtx) {
        if (ordersStatusPieChartInstance) ordersStatusPieChartInstance.destroy();
        const counts = { pending: 0, confirmed: 0, shipping: 0, delivered: 0, cancelled: 0 };
        orders.forEach(o => { if (counts.hasOwnProperty(o.trang_thai)) counts[o.trang_thai]++; });
        ordersStatusPieChartInstance = new Chart(pieCtx, {
          type: 'pie',
          data: {
            labels: ['Chờ xử lý', 'Đã xác nhận', 'Đang giao', 'Đã giao', 'Đã hủy'],
            datasets: [{
              data: Object.values(counts),
              backgroundColor: ['#f59e0b', '#3b82f6', '#8b5cf6', '#10b981', '#ef4444'],
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 12, usePointStyle: true } }
            }
          }
        });
      }
      
      // Weekly Orders Bar Chart
      const weeklyCtx = document.getElementById('ordersWeeklyChart');
      if (weeklyCtx) {
        if (ordersWeeklyChartInstance) ordersWeeklyChartInstance.destroy();
        const weekDays = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
        const weeklyData = Array(7).fill(0);
        const now = new Date();
        const weekStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay());
        
        orders.forEach(o => {
          const orderDate = new Date(o.thoi_gian);
          if (orderDate >= weekStart) {
            const dayOfWeek = orderDate.getDay();
            weeklyData[dayOfWeek]++;
          }
        });
        
        ordersWeeklyChartInstance = new Chart(weeklyCtx, {
          type: 'bar',
          data: {
            labels: weekDays,
            datasets: [{
              label: 'Đơn hàng',
              data: weeklyData,
              backgroundColor: 'rgba(139, 92, 246, 0.8)',
              borderRadius: 6,
              barThickness: 24
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
    }
    
    // ===================== PRODUCTS SECTION CHARTS =====================
    function initProductsSectionCharts(products) {
      // Update quick stats
      const total = products.length;
      const inStock = products.filter(p => (p.so_luong_ton || p.stock || 0) > 0).length;
      const outOfStock = products.filter(p => (p.so_luong_ton || p.stock || 0) <= 0).length;
      
      const totalEl = document.getElementById('products-total-count');
      const inStockEl = document.getElementById('products-instock-count');
      const outOfStockEl = document.getElementById('products-outofstock-count');
      
      if (totalEl) totalEl.textContent = total;
      if (inStockEl) inStockEl.textContent = inStock;
      if (outOfStockEl) outOfStockEl.textContent = outOfStock;
      
      // Products by Brand Chart
      const brandCtx = document.getElementById('productsByBrandChart');
      if (brandCtx) {
        if (productsByBrandChartInstance) productsByBrandChartInstance.destroy();
        const brandCounts = {};
        products.forEach(p => {
          const brandId = p.ma_hang || p.brand;
          const brandName = getBrandName(brandId);
          brandCounts[brandName] = (brandCounts[brandName] || 0) + 1;
        });
        
        const labels = Object.keys(brandCounts);
        const data = Object.values(brandCounts);
        const colors = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#06b6d4', '#84cc16'];
        
        productsByBrandChartInstance = new Chart(brandCtx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: colors.slice(0, labels.length),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
              legend: { position: 'bottom', labels: { padding: 10, usePointStyle: true, font: { size: 11 } } }
            }
          }
        });
      }
      
      // Price Distribution Chart
      const priceCtx = document.getElementById('productsPriceChart');
      if (priceCtx) {
        if (productsPriceChartInstance) productsPriceChartInstance.destroy();
        const priceRanges = {
          'Dưới 5 triệu': 0,
          '5-10 triệu': 0,
          '10-20 triệu': 0,
          '20-30 triệu': 0,
          'Trên 30 triệu': 0
        };
        
        products.forEach(p => {
          const price = (p.gia || p.price || 0) / 1000000;
          if (price < 5) priceRanges['Dưới 5 triệu']++;
          else if (price < 10) priceRanges['5-10 triệu']++;
          else if (price < 20) priceRanges['10-20 triệu']++;
          else if (price < 30) priceRanges['20-30 triệu']++;
          else priceRanges['Trên 30 triệu']++;
        });
        
        productsPriceChartInstance = new Chart(priceCtx, {
          type: 'bar',
          data: {
            labels: Object.keys(priceRanges),
            datasets: [{
              label: 'số Sản phẩm',
              data: Object.values(priceRanges),
              backgroundColor: ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444'],
              borderRadius: 6,
              barThickness: 32
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
    }
    
    // ===================== BRANDS SECTION CHARTS =====================
    function initBrandsSectionCharts(brands) {
      // Products by Brand Bar Chart
      const productsCtx = document.getElementById('brandsProductsChart');
      if (productsCtx) {
        if (brandsProductsChartInstance) brandsProductsChartInstance.destroy();
        const sortedBrands = [...brands].sort((a, b) => (b.so_san_pham || 0) - (a.so_san_pham || 0)).slice(0, 8);
        
        brandsProductsChartInstance = new Chart(productsCtx, {
          type: 'bar',
          data: {
            labels: sortedBrands.map(b => b.ten_hang),
            datasets: [{
              label: 'Sản phẩm',
              data: sortedBrands.map(b => b.so_san_pham || 0),
              backgroundColor: 'rgba(139, 92, 246, 0.8)',
              borderRadius: 6,
              barThickness: 28
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: {
              x: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
      
      // Brands by Country Pie Chart
      const countryCtx = document.getElementById('brandsByCountryChart');
      if (countryCtx) {
        if (brandsByCountryChartInstance) brandsByCountryChartInstance.destroy();
        const countryCounts = {};
        brands.forEach(b => {
          const country = b.ten_quoc_gia || 'Chưa cập nhật';
          countryCounts[country] = (countryCounts[country] || 0) + 1;
        });
        
        const colors = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#06b6d4'];
        
        brandsByCountryChartInstance = new Chart(countryCtx, {
          type: 'pie',
          data: {
            labels: Object.keys(countryCounts),
            datasets: [{
              data: Object.values(countryCounts),
              backgroundColor: colors.slice(0, Object.keys(countryCounts).length),
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom', labels: { padding: 10, usePointStyle: true, font: { size: 11 } } }
            }
          }
        });
      }
    }
    
    // ===================== CUSTOMERS SECTION CHARTS =====================
    function initCustomersSectionCharts(customers) {
      // Update quick stats
      const total = customers.length;
      const purchased = customers.filter(c => (c.so_don_hang || 0) > 0).length;
      const vip = customers.filter(c => (c.tong_chi_tieu || 0) >= 50000000).length;
      
      const totalEl = document.getElementById('customers-total-stat');
      const purchasedEl = document.getElementById('customers-purchased-stat');
      const vipEl = document.getElementById('customers-vip-stat');
      
      if (totalEl) totalEl.textContent = total;
      if (purchasedEl) purchasedEl.textContent = purchased;
      if (vipEl) vipEl.textContent = vip;
      
      // Monthly Customers Chart (fake data for demo)
      const monthlyCtx = document.getElementById('customersMonthlyChart');
      if (monthlyCtx) {
        if (customersMonthlyChartInstance) customersMonthlyChartInstance.destroy();
        const monthlyData = Array(12).fill(0).map(() => Math.floor(Math.random() * 20) + 5);
        
        customersMonthlyChartInstance = new Chart(monthlyCtx, {
          type: 'line',
          data: {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            datasets: [{
              label: 'Khách hàng mới',
              data: monthlyData,
              borderColor: '#8b5cf6',
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 4,
              pointBackgroundColor: '#8b5cf6'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 5 } }
            }
          }
        });
      }
      
      // Top Spending Customers Chart
      const spendingCtx = document.getElementById('customersTopSpendingChart');
      if (spendingCtx) {
        if (customersTopSpendingChartInstance) customersTopSpendingChartInstance.destroy();
        const topCustomers = [...customers].sort((a, b) => (b.tong_chi_tieu || 0) - (a.tong_chi_tieu || 0)).slice(0, 5);
        
        customersTopSpendingChartInstance = new Chart(spendingCtx, {
          type: 'bar',
          data: {
            labels: topCustomers.map(c => (c.ho_ten || 'Khách hàng').split(' ').slice(-2).join(' ')),
            datasets: [{
              label: 'chi tiêu',
              data: topCustomers.map(c => (c.tong_chi_tieu || 0) / 1000000),
              backgroundColor: ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444'],
              borderRadius: 6,
              barThickness: 28
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { callback: v => v + 'M' }
              }
            }
          }
        });
      }
    }
    
    // ===================== NEWS SECTION CHARTS =====================
    function initNewsSectionCharts(news) {
      // Update quick stats
      const total = news.length;
      const thisMonth = news.filter(n => {
        const d = new Date(n.ngay_dang);
        const now = new Date();
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      }).length;
      
      const totalEl = document.getElementById('news-total-stat');
      const monthlyEl = document.getElementById('news-monthly-stat');
      const viewsEl = document.getElementById('news-views-stat');
      
      if (totalEl) totalEl.textContent = total;
      if (monthlyEl) monthlyEl.textContent = thisMonth;
      if (viewsEl) viewsEl.textContent = Math.floor(Math.random() * 5000) + 1000; // Fake views for demo
      
      // Monthly News Chart
      const monthlyCtx = document.getElementById('newsMonthlyChart');
      if (monthlyCtx) {
        if (newsMonthlyChartInstance) newsMonthlyChartInstance.destroy();
        const monthlyData = Array(12).fill(0);
        news.forEach(n => {
          const m = new Date(n.ngay_dang).getMonth();
          monthlyData[m]++;
        });
        
        newsMonthlyChartInstance = new Chart(monthlyCtx, {
          type: 'bar',
          data: {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            datasets: [{
              label: 'Bài viết',
              data: monthlyData,
              backgroundColor: 'rgba(59, 130, 246, 0.8)',
              borderRadius: 6,
              barThickness: 20
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
    }
    
    // ===================== REVIEWS SECTION CHARTS =====================
    function initReviewsSectionCharts(reviews) {
      // Rating Distribution Chart
      const ratingCtx = document.getElementById('reviewsRatingChart');
      if (ratingCtx) {
        if (reviewsRatingChartInstance) reviewsRatingChartInstance.destroy();
        const ratingCounts = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };
        reviews.forEach(r => {
          const rating = Math.min(5, Math.max(1, r.so_sao || 0));
          ratingCounts[rating]++;
        });
        
        reviewsRatingChartInstance = new Chart(ratingCtx, {
          type: 'bar',
          data: {
            labels: ['5 sao', '4 sao', '3 sao', '2 sao', '1 sao'],
            datasets: [{
              label: 'Đánh giá',
              data: Object.values(ratingCounts),
              backgroundColor: ['#10b981', '#84cc16', '#f59e0b', '#f97316', '#ef4444'],
              borderRadius: 6,
              barThickness: 28
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: {
              x: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
      
      // Monthly Reviews Chart
      const monthlyCtx = document.getElementById('reviewsMonthlyChart');
      if (monthlyCtx) {
        if (reviewsMonthlyChartInstance) reviewsMonthlyChartInstance.destroy();
        const monthlyData = Array(12).fill(0);
        reviews.forEach(r => {
          const m = new Date(r.ngay_danh_gia).getMonth();
          monthlyData[m]++;
        });
        
        reviewsMonthlyChartInstance = new Chart(monthlyCtx, {
          type: 'line',
          data: {
            labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
            datasets: [{
              label: 'Đánh giá',
              data: monthlyData,
              borderColor: '#f59e0b',
              backgroundColor: 'rgba(245, 158, 11, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 4,
              pointBackgroundColor: '#f59e0b'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
    }
    
    async function loadOrders() {
      try { const res = await fetch(API_URL + '/admin/orders'); const data = await res.json(); allOrders = data.data || data || []; renderOrders(allOrders); initOrdersSectionCharts(allOrders); }
      catch(e) { allOrders = [{ma_don:1001,ten_nguoi_nhan:'Nguyen Van A',so_dt:'0901234567',tong_tien:34990000,trang_thai:'pending',thoi_gian:new Date()},{ma_don:1002,ten_nguoi_nhan:'Tran Thi B',so_dt:'0912345678',tong_tien:31990000,trang_thai:'confirmed',thoi_gian:new Date()}]; renderOrders(allOrders); initOrdersSectionCharts(allOrders); }
    }
    function renderOrders(orders) {
      const tbody = document.getElementById('orders-table');
      if (!orders.length) { tbody.innerHTML = '<tr><td colspan="8" class="py-8 text-center text-slate-400">Không có đơn hàng</td></tr>'; return; }
      tbody.innerHTML = orders.map(o => {
        const cancelReasonHtml = o.trang_thai === 'cancelled' && o.ly_do_huy 
          ? '<div class="text-xs text-red-500 mt-1"><i class="fas fa-info-circle mr-1"></i>' + o.ly_do_huy + '</div>' 
          : '';
        
        // Hiển thị trạng thái dạng badge (không phải dropdown)
        let statusBadgeHtml = '';
        let nextStatus = '';
        let updateBtnHtml = '';
        
        if (o.trang_thai === 'pending') {
          statusBadgeHtml = '<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-amber-100 text-amber-700 text-xs font-semibold rounded-full"><i class="fas fa-clock"></i> Chờ xử lý</span>';
          nextStatus = 'confirmed';
          updateBtnHtml = '<button onclick="quickUpdateOrderStatus(' + o.ma_don + ', \'confirmed\')" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-emerald-500 to-green-500 text-white text-xs font-semibold rounded-lg hover:from-emerald-600 hover:to-green-600 transition-all shadow-md hover:shadow-lg transform hover:scale-105" title="Xác nhận đơn hàng"><i class="fas fa-check"></i><span>Xác nhận</span></button>';
        } else if (o.trang_thai === 'confirmed') {
          statusBadgeHtml = '<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-100 text-blue-700 text-xs font-semibold rounded-full"><i class="fas fa-check-circle"></i> Đã xác nhận</span>';
          nextStatus = 'shipping';
          updateBtnHtml = '<button onclick="quickUpdateOrderStatus(' + o.ma_don + ', \'shipping\')" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-xs font-semibold rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-md hover:shadow-lg transform hover:scale-105" title="Chuyển sang giao hàng"><i class="fas fa-truck"></i><span>Giao hàng</span></button>';
        } else if (o.trang_thai === 'shipping') {
          statusBadgeHtml = '<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full"><i class="fas fa-shipping-fast"></i> Đang giao</span>';
          nextStatus = 'delivered';
          updateBtnHtml = '<button onclick="quickUpdateOrderStatus(' + o.ma_don + ', \'delivered\')" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-gradient-to-r from-purple-500 to-violet-500 text-white text-xs font-semibold rounded-lg hover:from-purple-600 hover:to-violet-600 transition-all shadow-md hover:shadow-lg transform hover:scale-105" title="Xác nhận đã giao"><i class="fas fa-box-open"></i><span>Đã giao</span></button>';
        } else if (o.trang_thai === 'delivered') {
          statusBadgeHtml = '<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-emerald-100 text-emerald-700 text-xs font-semibold rounded-full"><i class="fas fa-check-double"></i> Đã giao</span>';
        } else if (o.trang_thai === 'cancelled') {
          statusBadgeHtml = '<span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-red-100 text-red-700 text-xs font-semibold rounded-full"><i class="fas fa-times-circle"></i> Đã hủy</span>';
        }
        
        return '<tr class="border-b border-slate-50 hover:bg-slate-50/50 transition-colors">' +
          '<td class="px-6 py-4 font-bold text-violet-600">#' + o.ma_don + '</td>' +
          '<td class="px-6 py-4 font-medium text-dark-700">' + (o.ten_nguoi_nhan || 'N/A') + '</td>' +
          '<td class="px-6 py-4 text-slate-500">' + (o.so_dt || 'N/A') + '</td>' +
          '<td class="px-6 py-4 font-bold text-emerald-600">' + formatCurrency(o.tong_tien) + '</td>' +
          '<td class="px-6 py-4">' + statusBadgeHtml + cancelReasonHtml + '</td>' +
          '<td class="px-6 py-4 text-slate-500">' + formatDate(o.thoi_gian) + '</td>' +
          '<td class="px-6 py-4"><div class="flex items-center gap-2">' +
            '<button onclick="viewOrderDetail(' + o.ma_don + ')" class="w-9 h-9 flex items-center justify-center bg-violet-100 text-violet-600 rounded-lg hover:bg-violet-200 transition-all" title="Xem chi tiết"><i class="fas fa-eye"></i></button>' +
            '<button onclick="openEditOrderStatusModal(' + o.ma_don + ', \'' + o.trang_thai + '\')" class="w-9 h-9 flex items-center justify-center bg-amber-100 text-amber-600 rounded-lg hover:bg-amber-200 transition-all" title="Chỉnh sửa trạng thái"><i class="fas fa-edit"></i></button>' +
            updateBtnHtml +
          '</div></td></tr>';
      }).join('');
    }
    
    // Hàm cập nhật nhanh trạng thái (theo flow logic)
    async function quickUpdateOrderStatus(orderId, nextStatus) {
      const statusText = {
        'pending': 'Chờ xử lý',
        'confirmed': 'Đã xác nhận', 
        'shipping': 'Đang giao',
        'delivered': 'Đã giao',
        'cancelled': 'Đã hủy'
      };
      
      if (confirm('Xác nhận chuyển đơn hàng #' + orderId + ' sang trạng thái "' + statusText[nextStatus] + '"?')) {
        await updateOrderStatus(orderId, nextStatus);
      }
    }
    
    // Mở modal chỉnh sửa trạng thái đơn hàng
    function openEditOrderStatusModal(orderId, currentStatus) {
      const statusText = {
        'pending': 'Chờ xử lý',
        'confirmed': 'Đã xác nhận', 
        'shipping': 'Đang giao',
        'delivered': 'Đã giao',
        'cancelled': 'Đã hủy'
      };
      
      // Tạo modal HTML
      const modalHtml = `
        <div id="edit-order-status-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden animate-fade-in">
            <div class="bg-gradient-to-r from-primary-600 to-primary-700 p-5 text-white">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="font-bold text-lg">Cập nhật trạng thái đơn hàng</h3>
                  <p class="text-primary-100 text-sm">Đơn hàng #${orderId}</p>
                </div>
                <button onclick="closeEditOrderStatusModal()" class="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="p-6">
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Trạng thái hiện tại</label>
                <div class="px-4 py-3 bg-gray-100 rounded-lg text-gray-600 font-medium">${statusText[currentStatus]}</div>
              </div>
              <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Chọn trạng thái mới</label>
                <select id="new-order-status" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 text-sm font-medium focus:border-primary-400 focus:ring-2 focus:ring-primary-100 transition-all">
                  <option value="pending" ${currentStatus === 'pending' ? 'selected' : ''}>🔵 Chờ xử lý</option>
                  <option value="confirmed" ${currentStatus === 'confirmed' ? 'selected' : ''}>🔵 Đã xác nhận</option>
                  <option value="shipping" ${currentStatus === 'shipping' ? 'selected' : ''}>📦 Đang giao</option>
                  <option value="delivered" ${currentStatus === 'delivered' ? 'selected' : ''}>📦 Đã giao</option>
                  <option value="cancelled" ${currentStatus === 'cancelled' ? 'selected' : ''}>🔵 Đã hủy</option>
                </select>
              </div>
              <div class="flex gap-3">
                <button onclick="closeEditOrderStatusModal()" class="flex-1 px-4 py-3 border-2 border-gray-200 text-gray-600 font-semibold rounded-xl hover:bg-gray-50 transition">
                  <i class="fas fa-times mr-2"></i>Hủy
                </button>
                <button onclick="saveOrderStatus(${orderId})" class="flex-1 px-4 py-3 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold rounded-xl hover:from-primary-600 hover:to-primary-700 transition shadow-lg">
                  <i class="fas fa-save mr-2"></i>Cập nhật
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // Thêm modal vào body
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    // Xem chi tiết đơn hàng
    async function viewOrderDetail(orderId) {
      try {
        // Tìm đơn hàng trong danh sách hoặc gọi API
        let order = allOrders.find(o => o.ma_don === orderId);
        
        // Nếu không tìm thấy trong cache, gọi API
        if (!order) {
          const res = await fetch(API_URL + '/admin/orders/' + orderId);
          const data = await res.json();
          order = data.data || data;
        }
        
        if (!order) {
          showToast('Không tìm thấy đơn hàng', 'error');
          return;
        }
        
        const statusText = {
          'pending': '? Chờ xử lý',
          'confirmed': '? Đã xác nhận', 
          'shipping': '📦 Đang giao',
          'delivered': '📦 Đã giao',
          'cancelled': '? Đã hủy'
        };
        
        const statusColors = {
          'pending': 'bg-amber-100 text-amber-700',
          'confirmed': 'bg-blue-100 text-blue-700',
          'shipping': 'bg-purple-100 text-purple-700',
          'delivered': 'bg-emerald-100 text-emerald-700',
          'cancelled': 'bg-red-100 text-red-700'
        };
        
        // Lấy chi tiết sản phẩm trong đơn hàng
        let orderItemsHtml = '';
        if (order.chi_tiet && order.chi_tiet.length > 0) {
          orderItemsHtml = order.chi_tiet.map(item => `
            <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl">
              <img src="${item.anh_sp || item.image || '/images/placeholder.png'}" class="w-16 h-16 object-cover rounded-lg" onerror="this.src='/images/placeholder.png'">
              <div class="flex-1">
                <p class="font-semibold text-gray-800">${item.ten_sp || item.name || 'Sản phẩm'}</p>
                <p class="text-sm text-gray-500">${item.mau_sac || ''} ${item.bo_nho || ''}</p>
                <p class="text-sm text-gray-500">Số lượng: <span class="font-medium">${item.so_luong || 1}</span></p>
              </div>
              <div class="text-right">
                <p class="font-bold text-violet-600">${formatCurrency(item.gia || item.price || 0)}</p>
              </div>
            </div>
          `).join('');
        } else {
          orderItemsHtml = '<p class="text-gray-500 text-center py-4">Chưa có thông tin sản phẩm</p>';
        }
        
        // Tạo modal HTML
        const modalHtml = `
          <div id="order-detail-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto">
            <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden my-8">
              <div class="bg-gradient-to-r from-violet-600 to-purple-600 p-5 text-white">
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="font-bold text-xl">Chi tiết đơn hàng #${order.ma_don}</h3>
                    <p class="text-violet-100 text-sm">Ngày đặt: ${formatDate(order.thoi_gian || order.ngay_dat)}</p>
                  </div>
                  <button onclick="closeOrderDetailModal()" class="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition">
                    <i class="fas fa-times text-lg"></i>
                  </button>
                </div>
              </div>
              
              <div class="p-6 overflow-y-auto max-h-[60vh]">
                <!-- trạng thái đơn hàng -->
                <div class="flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-xl">
                  <span class="font-semibold text-gray-700">trạng thái:</span>
                  <span class="px-4 py-2 rounded-full text-sm font-semibold ${statusColors[order.trang_thai] || 'bg-gray-100 text-gray-700'}">${statusText[order.trang_thai] || order.trang_thai}</span>
                </div>
                
                <!-- Thông tin khách hàng -->
                <div class="mb-6">
                  <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="fas fa-user text-violet-500"></i> Thông tin khách hàng
                  </h4>
                  <div class="grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-xl">
                    <div>
                      <p class="text-sm text-gray-500">Họ tên</p>
                      <p class="font-semibold text-gray-800">${order.ten_nguoi_nhan || order.ho_ten || 'N/A'}</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-500">Số điện thoại</p>
                      <p class="font-semibold text-gray-800">${order.so_dt || 'N/A'}</p>
                    </div>
                    <div class="col-span-2">
                      <p class="text-sm text-gray-500">Địa chỉ giao hàng</p>
                      <p class="font-semibold text-gray-800">${order.dia_chi || 'N/A'}</p>
                    </div>
                    ${order.ghi_chu ? `
                    <div class="col-span-2">
                      <p class="text-sm text-gray-500">Ghi chú</p>
                      <p class="font-semibold text-gray-800">${order.ghi_chu}</p>
                    </div>
                    ` : ''}}
                  </div>
                </div>
                
                <!-- Sản phẩm trong đơn -->
                <div class="mb-6">
                  <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="fas fa-box text-violet-500"></i> Sản phẩm đặt mua
                  </h4>
                  <div class="space-y-3">
                    ${orderItemsHtml}
                  </div>
                </div>
                
                <!-- Tổng tiền -->
                <div class="border-t-2 border-dashed border-gray-200 pt-4">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-gray-600">Tạm tính:</span>
                    <span class="font-medium">${formatCurrency(order.tong_tien || 0)}</span>
                  </div>
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-gray-600">Phí vận chuyển:</span>
                    <span class="font-medium text-emerald-600">Miễn phí</span>
                  </div>
                  <div class="flex items-center justify-between pt-3 border-t border-gray-200">
                    <span class="text-lg font-bold text-gray-800">Tổng cộng:</span>
                    <span class="text-xl font-bold text-violet-600">${formatCurrency(order.tong_tien || 0)}</span>
                  </div>
                </div>
                
                ${order.trang_thai === 'cancelled' && order.ly_do_huy ? `
                <div class="mt-4 p-4 bg-red-50 rounded-xl border border-red-200">
                  <p class="text-sm text-red-600 font-medium"><i class="fas fa-info-circle mr-2"></i>Lý do hủy: ${order.ly_do_huy}</p>
                </div>
                ` : ''}
              </div>
              
              <div class="p-4 bg-gray-50 border-t flex gap-3">
                <button onclick="closeOrderDetailModal()" class="flex-1 px-4 py-3 border-2 border-gray-200 text-gray-600 font-semibold rounded-xl hover:bg-gray-100 transition">
                  <i class="fas fa-times mr-2"></i>Đóng
                </button>
                <button onclick="closeOrderDetailModal(); openEditOrderStatusModal(${order.ma_don}, '${order.trang_thai}')" class="flex-1 px-4 py-3 bg-gradient-to-r from-violet-500 to-purple-500 text-white font-semibold rounded-xl hover:from-violet-600 hover:to-purple-600 transition shadow-lg">
                  <i class="fas fa-edit mr-2"></i>Cập nhật trạng thái
                </button>
              </div>
            </div>
          </div>
        `;
        
        // Thêm modal vào body
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
      } catch (error) {
        console.error('Error viewing order detail:', error);
        showToast('Lỗi khi tải chi tiết đơn hàng', 'error');
      }
    }
    
    // Đóng modal chi tiết đơn hàng
    function closeOrderDetailModal() {
      const modal = document.getElementById('order-detail-modal');
      if (modal) modal.remove();
    }
    
    // Đóng modal
    function closeEditOrderStatusModal() {
      const modal = document.getElementById('edit-order-status-modal');
      if (modal) modal.remove();
    }
    
    // Lưu trạng thái đơn hàng từ modal
    async function saveOrderStatus(orderId) {
      const newStatus = document.getElementById('new-order-status').value;
      closeEditOrderStatusModal();
      await updateOrderStatus(orderId, newStatus);
    }
    
    async function updateOrderStatus(id, status) { 
      try { 
        const res = await fetch(API_URL + '/admin/orders/' + id + '/status', { 
          method: 'PUT', 
          headers: {'Content-Type':'application/json'}, 
          body: JSON.stringify({status:status}) 
        }); 
        const data = await res.json();
        if (data.success) {
          showToast('Cập nhật đơn hàng #' + id + ' thành công!', 'success');
          // Reload lại danh sách đơn hàng
          loadOrders();
        } else {
          showToast(data.message || 'Lỗi cập nhật', 'error');
        }
      } catch(e) { 
        console.error('Error updating order:', e);
        showToast('Lỗi cập nhật: ' + e.message, 'error'); 
      } 
    }
    let allBrands = [], editingProductId = null, configProductId = null, configProductName = '';
    async function loadBrands() {
      try {
        const res = await fetch(API_URL + '/admin/brands');
        const data = await res.json();
        console.log('Brands API response:', data);
        allBrands = data.data || data || [];
        console.log('allBrands:', allBrands);
        const select = document.getElementById('product-brand');
        const filter = document.getElementById('product-brand-filter');
        if (!select) { console.error('product-brand element not found!'); return; }
        const options = '<option value="">Chọn Hãng</option>' + allBrands.map(b => '<option value="' + b.ma_hang + '">' + b.ten_hang + '</option>').join('');
        const filterOptions = '<option value="">Tất cả hãng</option>' + allBrands.map(b => '<option value="' + b.ma_hang + '">' + b.ten_hang + '</option>').join('');
        select.innerHTML = options;
        if (filter) filter.innerHTML = filterOptions;
        console.log('Brands loaded successfully:', allBrands.length, 'brands');
      } catch(e) { console.error('Error loading brands:', e); }
    }
    function getBrandName(brandIdOrSlug) {
      // Hỗ trợ cả ma_hang (number) và brand slug (string)
      if (!brandIdOrSlug) return 'N/A';
      
      // Nếu là số, tìm theo ma_hang
      if (typeof brandIdOrSlug === 'number') {
        const brand = allBrands.find(b => b.ma_hang === brandIdOrSlug);
        return brand ? brand.ten_hang : 'N/A';
      }
      
      // Nếu là string (slug), tìm theo ten_hang (lowercase)
      const slug = brandIdOrSlug.toString().toLowerCase();
      const brand = allBrands.find(b => b.ten_hang.toLowerCase() === slug);
      if (brand) return brand.ten_hang;
      
      // Fallback: capitalize first letter
      return slug.charAt(0).toUpperCase() + slug.slice(1);
    }
    async function loadProducts() {
      try {
        const res = await fetch(API_URL + '/products');
        allProducts = await res.json();
        renderProducts(allProducts);
        initProductsSectionCharts(allProducts);
      } catch(e) {
        console.error('Error loading products:', e);
        showToast('Lỗi tải sản phẩm', 'error');
      }
    }
    function renderProducts(products) {
      const tbody = document.getElementById('products-table');
      if (!products.length) { tbody.innerHTML = '<tr><td colspan="6" class="py-8 text-center text-slate-400">Không có Sản phẩm</td></tr>'; return; }
      tbody.innerHTML = products.map(p => {
        const productId = p.ma_sp || p.id;
        const productName = p.ten_sp || p.name || 'N/A';
        const productImage = p.anh_dai_dien || p.image || PLACEHOLDER_IMAGE;
        const productStorage = p.bo_nho || p.storage || '';
        const productColor = p.mau_sac || '';
        const productPrice = p.gia || p.price || 0;
        const productStock = p.so_luong_ton || p.stock || 0;
        const brandIdOrSlug = p.ma_hang || p.brand;
        return '<tr class="border-b border-slate-50 hover:bg-slate-50"><td class="py-4"><img src="' + productImage + '" class="w-16 h-16 object-cover rounded-xl" onerror="this.src=\'' + PLACEHOLDER_IMAGE + '\'"></td><td class="py-4"><p class="font-medium">' + productName + '</p><p class="text-xs text-slate-500">' + productStorage + (productColor ? ' - ' + productColor : '') + '</p></td><td class="py-4"><span class="px-2 py-1 bg-slate-100 rounded-lg text-xs font-medium">' + getBrandName(brandIdOrSlug) + '</span></td><td class="py-4 font-semibold text-violet-600">' + formatCurrency(productPrice) + '</td><td class="py-4"><span class="px-2 py-1 rounded-lg text-xs font-medium ' + (productStock>10?'bg-emerald-100 text-emerald-700':productStock>0?'bg-amber-100 text-amber-700':'bg-red-100 text-red-700') + '">' + productStock + '</span></td><td class="py-4 space-x-2"><button onclick="viewProduct(' + productId + ')" class="text-violet-600 hover:text-violet-800" title="Xem"><i class="fas fa-eye"></i></button><button onclick="editProduct(' + productId + ')" class="text-blue-600 hover:text-blue-800" title="Sửa"><i class="fas fa-edit"></i></button><button onclick="editConfig(' + productId + ')" class="text-emerald-600 hover:text-emerald-800" title="Cấu hình"><i class="fas fa-cog"></i></button><button onclick="deleteProduct(' + productId + ')" class="text-red-600 hover:text-red-800" title="Xóa"><i class="fas fa-trash"></i></button></td></tr>';
      }).join('');
    }
    function openProductModal(productId) {
      editingProductId = productId || null;
      const modal = document.getElementById('product-modal');
      const form = document.getElementById('product-form');
      form.reset();
      resetImagePreview(); // Reset preview ảnh
      
      // Đảm bảo brands đã được load
      if (allBrands.length === 0) {
        loadBrands();
      }
      
      if (productId) {
        const product = allProducts.find(p => (p.ma_sp || p.id) === productId);
        if (product) {
          document.getElementById('product-modal-title').textContent = 'Chỉnh sửa Sản phẩm';
          document.getElementById('product-submit-text').textContent = 'Tiếp tục';
          document.getElementById('product-id').value = product.ma_sp || product.id;
          document.getElementById('product-name').value = product.ten_sp || product.name || '';
          document.getElementById('product-brand').value = product.ma_hang || '';
          document.getElementById('product-price').value = product.gia || product.price || '';
          document.getElementById('product-stock').value = product.so_luong_ton || product.stock || '';
          document.getElementById('product-storage').value = product.bo_nho || product.storage || '128';
          document.getElementById('product-description').value = product.mo_ta || product.description || '';
          document.getElementById('product-image').value = product.anh_dai_dien || product.image || '';
          
          // Load Màu sắc t? database (JSON format: {colors: [...], colorNames: [...]})
          resetColorPicker();
          if (product.mau_sac) {
            try {
              const colorData = typeof product.mau_sac === 'string' ? JSON.parse(product.mau_sac) : product.mau_sac;
              if (colorData.colors && colorData.colorNames) {
                loadColorsFromData(colorData.colors, colorData.colorNames);
              }
            } catch(e) {
              console.log('Could not parse color data:', e);
            }
          }
          
          // Hien thi anh hien tai neu co
          const existingImage = product.anh_dai_dien || product.image;
          if (existingImage) {
            document.getElementById('preview-img').src = existingImage;
            document.getElementById('preview-img').classList.remove('hidden');
            document.getElementById('image-placeholder').classList.add('hidden');
          }
        }
      } else {
        document.getElementById('product-modal-title').textContent = 'Thêm Sản phẩm mới';
        document.getElementById('product-submit-text').textContent = 'Tiếp tục';
        resetColorPicker();
      }
      modal.classList.remove('hidden');
    }
    function closeProductModal() {
      document.getElementById('product-modal').classList.add('hidden');
      editingProductId = null;
      resetImagePreview();
    }
    function viewProduct(id) {
      const product = allProducts.find(p => (p.ma_sp || p.id) === id);
      if (product) {
        const name = product.ten_sp || product.name || 'N/A';
        const price = product.gia || product.price || 0;
        const stock = product.so_luong_ton || product.stock || 0;
        const color = product.mau_sac || 'N/A';
        const storage = product.bo_nho || product.storage || 'N/A';
        const desc = product.mo_ta || product.description || 'Không có';
        alert('CHI TIẾT SẢN PHẨM\n\nTên: ' + name + '\nHãng: ' + getBrandName(product.ma_hang) + '\nGiá: ' + formatCurrency(price) + '\nTồn kho: ' + stock + '\nMàu sắc: ' + color + '\nBộ nhớ: ' + storage + '\nMô tả: ' + desc);
      }
    }
    function editProduct(id) { openProductModal(id); }
    function editConfig(id) {
      const product = allProducts.find(p => (p.ma_sp || p.id) === id);
      if (product) {
        openConfigModal(id, product.ten_sp || product.name || 'San pham');
      }
    }
    async function deleteProduct(id) {
      if (!confirm('Bạn có chắc chắn muốn xóa sản phẩm này?')) return;
      try {
        const res = await fetch(API_URL + '/admin/products/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
          showToast('Xóa sản phẩm thành công');
          loadProducts();
        } else {
          showToast(data.message || 'Lỗi xóa sản phẩm', 'error');
        }
      } catch(e) {
        console.error('Error deleting product:', e);
        showToast('Lỗi xóa sản phẩm', 'error');
      }
    }
    // Buoc 2: Mo modal cau hinh
    function openConfigModal(productId, productName) {
      configProductId = productId;
      configProductName = productName;
      document.getElementById('product-modal').classList.add('hidden');
      document.getElementById('config-product-id').value = productId;
      document.getElementById('config-product-name').textContent = 'Sản phẩm: ' + productName;
      document.getElementById('config-form').reset();
      loadConfigForProduct(productId);
      document.getElementById('config-modal').classList.remove('hidden');
    }
    async function loadConfigForProduct(productId) {
      try {
        const res = await fetch(API_URL + '/admin/products/' + productId + '/specs');
        const data = await res.json();
        if (data.success && data.data) {
          const specs = data.data;
          document.getElementById('config-ram').value = specs.ram || '';
          document.getElementById('config-chip').value = specs.chip || '';
          document.getElementById('config-screen').value = specs.man_hinh || '';
          document.getElementById('config-camera').value = specs.camera || '';
          document.getElementById('config-battery').value = specs.pin || '';
          document.getElementById('config-os').value = specs.he_dieu_hanh || '';
        }
      } catch(e) { console.log('Chưa có cấu hình cho sản phẩm này'); }
    }
    function closeConfigModal() {
      document.getElementById('config-modal').classList.add('hidden');
      configProductId = null;
      loadProducts();
      loadDashboardData();
    }
    function skipConfig() {
      showToast('Đã thêm sản phẩm. Bạn có thể thêm cấu hình sau.');
      closeConfigModal();
    }
    function backToProductModal() {
      document.getElementById('config-modal').classList.add('hidden');
      if (configProductId) {
        editingProductId = configProductId;
        openProductModal(configProductId);
      }
    }
    // Config form submit
    document.getElementById('config-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const configData = {
        ram: document.getElementById('config-ram').value,
        chip: document.getElementById('config-chip').value,
        man_hinh: document.getElementById('config-screen').value,
        camera: document.getElementById('config-camera').value,
        pin: document.getElementById('config-battery').value,
        he_dieu_hanh: document.getElementById('config-os').value
      };
      try {
        const res = await fetch(API_URL + '/admin/products/' + configProductId + '/specs', {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(configData)
        });
        const data = await res.json();
        if (data.success) {
          showToast('Lưu cấu hình thành công!');
          closeConfigModal();
        } else {
          showToast(data.message || 'Lỗi lưu cấu hình', 'error');
        }
      } catch(e) {
        console.error('Error saving config:', e);
        showToast('Lỗi lưu cấu hình', 'error');
      }
    });
    // Product form submit - Buoc 1
    document.getElementById('product-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      let imageUrl = document.getElementById('product-image').value || null;
      
      // Neu co file anh duoc chon, upload truoc
      if (selectedImageFile) {
        try {
          const formData = new FormData();
          formData.append('image', selectedImageFile);
          
          const uploadRes = await fetch(API_URL + '/admin/upload', {
            method: 'POST',
            body: formData
          });
          const uploadData = await uploadRes.json();
          
          if (uploadData.success && uploadData.url) {
            imageUrl = uploadData.url;
          } else {
            // Fallback: Dung data URL
            imageUrl = document.getElementById('preview-img').src;
          }
        } catch(uploadErr) {
          console.log('Upload failed, using data URL');
          imageUrl = document.getElementById('preview-img').src;
        }
      }
      
      const productData = {
        ten_sp: document.getElementById('product-name').value,
        ma_hang: document.getElementById('product-brand').value,
        gia: document.getElementById('product-price').value,
        so_luong_ton: document.getElementById('product-stock').value,
        mau_sac: document.getElementById('product-color').value || null,
        ten_mau_sac: document.getElementById('product-color-names').value || null,
        bo_nho: document.getElementById('product-storage').value || null,
        mo_ta: document.getElementById('product-description').value || null,
        anh_dai_dien: imageUrl
      };
      try {
        if (editingProductId) {
          const res = await fetch(API_URL + '/admin/products/' + editingProductId, { 
            method: 'PUT', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify(productData) 
          });
          const data = await res.json();
          if (data.success) {
            showToast('Cập nhật sản phẩm thành công! Tiếp tục thêm cấu hình...');
            // Upload gallery images
            await uploadGalleryImages(editingProductId);
            openConfigModal(editingProductId, productData.ten_sp);
          } else {
            showToast(data.message || 'Lỗi cập nhật sản phẩm', 'error');
          }
        } else {
          const res = await fetch(API_URL + '/admin/products', { 
            method: 'POST', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify(productData) 
          });
          const data = await res.json();
          if (data.success) {
            showToast('Thêm sản phẩm thành công! Tiếp tục thêm cấu hình...');
            // Upload gallery images
            await uploadGalleryImages(data.data.id);
            closeProductModal();
            openConfigModal(data.data.id, productData.ten_sp);
          } else {
            showToast(data.message || 'Lỗi thêm sản phẩm', 'error');
          }
        }
      } catch(e) {
        console.error('Error saving product:', e);
        showToast('Lỗi lưu sản phẩm', 'error');
      }
    });
    
    // Upload gallery images cho san pham
    async function uploadGalleryImages(productId) {
      if (galleryImageFiles.length === 0) return;
      
      try {
        for (const img of galleryImageFiles) {
          const formData = new FormData();
          formData.append('image', img.file);
          formData.append('productId', productId);
          
          const uploadRes = await fetch(API_URL + '/admin/upload-gallery', {
            method: 'POST',
            body: formData
          });
          const uploadData = await uploadRes.json();
          
          if (!uploadData.success) {
            console.log('Failed to upload gallery image:', uploadData.message);
          }
        }
        showToast('Đã upload ' + galleryImageFiles.length + ' ảnh mô tả');
      } catch(err) {
        console.error('Error uploading gallery:', err);
      }
    }
    
    async function loadCustomers() {
      try { const res = await fetch(API_URL + '/admin/customers'); const data = await res.json(); allCustomers = data.data || data || []; renderCustomers(allCustomers); initCustomersSectionCharts(allCustomers); }
      catch(e) { allCustomers = [{ma_kh:1,ho_ten:'Nguyen Van A',email:'a@email.com',so_dt:'0901234567',so_don_hang:5,tong_chi_tieu:150000000},{ma_kh:2,ho_ten:'Tran Thi B',email:'b@email.com',so_dt:'0912345678',so_don_hang:3,tong_chi_tieu:89000000}]; renderCustomers(allCustomers); initCustomersSectionCharts(allCustomers); }
    }
    function renderCustomers(customers) {
      const tbody = document.getElementById('customers-table');
      if (!customers.length) { tbody.innerHTML = '<tr><td colspan="7" class="py-8 text-center text-slate-400">Không có khách hàng</td></tr>'; return; }
      tbody.innerHTML = customers.map(c => '<tr class="border-b border-slate-50 hover:bg-slate-50/50 transition-colors"><td class="px-4 py-4">' + (c.avt ? '<img src="' + c.avt + '" class="w-10 h-10 rounded-full object-cover">' : '<div class="w-10 h-10 rounded-full bg-violet-500 flex items-center justify-center text-white font-medium">' + (c.ho_ten||'K').charAt(0) + '</div>') + '</td><td class="px-4 py-4 font-medium">' + (c.ho_ten || 'N/A') + '</td><td class="px-4 py-4 text-slate-500">' + (c.email || 'N/A') + '</td><td class="px-4 py-4 text-slate-500">' + (c.so_dt || 'N/A') + '</td><td class="px-4 py-4"><span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium">' + (c.so_don_hang || 0) + '</span></td><td class="px-4 py-4 font-semibold text-emerald-600">' + formatCurrency(c.tong_chi_tieu || 0) + '</td><td class="px-4 py-4"><button onclick="viewCustomerDetail(' + c.ma_kh + ')" class="w-8 h-8 flex items-center justify-center bg-violet-100 text-violet-600 rounded-lg hover:bg-violet-200 transition-all" title="Xem chi tiết"><i class="fas fa-eye"></i></button></td></tr>').join('');
    }
    
    // Xem chi tiết khách hàng
    async function viewCustomerDetail(customerId) {
      const customer = allCustomers.find(c => c.ma_kh === customerId);
      if (!customer) {
        showToast('Không tìm thấy khách hàng', 'error');
        return;
      }
      
      const modalHtml = `
        <div id="customer-detail-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden">
            <div class="bg-gradient-to-r from-violet-600 to-purple-600 p-5 text-white text-center">
              <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-white/20 flex items-center justify-center overflow-hidden">
                ${customer.avt ? `<img src="${customer.avt}" class="w-full h-full object-cover">` : `<span class="text-3xl font-bold">${(customer.ho_ten || 'K').charAt(0)}</span>`}
              </div>
              <h3 class="font-bold text-xl">${customer.ho_ten || 'N/A'}</h3>
              <p class="text-violet-100 text-sm">Khách hàng #${customer.ma_kh}</p>
            </div>
            <div class="p-6">
              <div class="space-y-4">
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                  <i class="fas fa-envelope text-violet-500 w-5"></i>
                  <div>
                    <p class="text-xs text-gray-500">Email</p>
                    <p class="font-medium text-gray-800">${customer.email || 'Chưa cập nhật'}</p>
                  </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                  <i class="fas fa-phone text-violet-500 w-5"></i>
                  <div>
                    <p class="text-xs text-gray-500">Số điện thoại</p>
                    <p class="font-medium text-gray-800">${customer.so_dt || 'Chưa cập nhật'}</p>
                  </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                  <i class="fas fa-map-marker-alt text-violet-500 w-5"></i>
                  <div>
                    <p class="text-xs text-gray-500">Địa chỉ</p>
                    <p class="font-medium text-gray-800">${customer.dia_chi || 'Chưa cập nhật'}</p>
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                  <div class="p-3 bg-blue-50 rounded-xl text-center">
                    <p class="text-2xl font-bold text-blue-600">${customer.so_don_hang || 0}</p>
                    <p class="text-xs text-blue-600">Đơn hàng</p>
                  </div>
                  <div class="p-3 bg-emerald-50 rounded-xl text-center">
                    <p class="text-lg font-bold text-emerald-600">${formatCurrency(customer.tong_chi_tieu || 0)}</p>
                    <p class="text-xs text-emerald-600">Tổng chi tiêu</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="p-4 bg-gray-50 border-t">
              <button onclick="closeCustomerDetailModal()" class="w-full px-4 py-3 bg-gradient-to-r from-violet-500 to-purple-500 text-white font-semibold rounded-xl hover:from-violet-600 hover:to-purple-600 transition">
                <i class="fas fa-times mr-2"></i>Đóng
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    
    function closeCustomerDetailModal() {
      const modal = document.getElementById('customer-detail-modal');
      if (modal) modal.remove();
    }
    
    async function loadReviews() {
      try { const res = await fetch(API_URL + '/admin/reviews'); const data = await res.json(); allReviews = data.data || data || []; renderReviews(allReviews); updateReviewStats(allReviews); initReviewsSectionCharts(allReviews); }
      catch(e) { allReviews = [{ma_dg:1,ho_ten:'Nguyen Van A',ten_sp:'iPhone 15 Pro',so_sao:5,binh_luan:'San pham tuyet voi!',ngay_danh_gia:new Date()},{ma_dg:2,ho_ten:'Tran Thi B',ten_sp:'Samsung S24',so_sao:4,binh_luan:'Rat hai long',ngay_danh_gia:new Date()}]; renderReviews(allReviews); updateReviewStats(allReviews); initReviewsSectionCharts(allReviews); }
    }
    function renderReviews(reviews) {
      const tbody = document.getElementById('reviews-table');
      if (!reviews.length) { tbody.innerHTML = '<tr><td colspan="6" class="py-8 text-center text-slate-400">Không có đánh giá</td></tr>'; return; }
      tbody.innerHTML = reviews.map(r => '<tr class="border-b border-slate-50"><td class="py-4"><div class="flex items-center gap-2">' + (r.avt ? '<img src="' + r.avt + '" class="w-8 h-8 rounded-full object-cover">' : '<div class="w-8 h-8 rounded-full bg-violet-100 flex items-center justify-center text-violet-600 font-medium text-sm">' + (r.ho_ten||'K').charAt(0) + '</div>') + '<span class="font-medium">' + (r.ho_ten||'Khách hàng') + '</span></div></td><td class="py-4 text-slate-500">' + (r.ten_sp || 'N/A') + '</td><td class="py-4"><div class="flex items-center gap-1">' + renderStars(r.so_sao) + '</div></td><td class="py-4 text-slate-600 max-w-[200px] truncate">' + (r.binh_luan || '') + '</td><td class="py-4 text-slate-500">' + formatDate(r.ngay_danh_gia) + '</td><td class="py-4 space-x-2"><button onclick="viewReview(' + r.ma_dg + ')" class="text-violet-600 hover:text-violet-800" title="Xem chi tiết"><i class="fas fa-eye"></i></button><button onclick="deleteReview(' + r.ma_dg + ')" class="text-red-600 hover:text-red-800" title="Xóa"><i class="fas fa-trash"></i></button></td></tr>').join('');
    }
    function updateReviewStats(reviews) {
      const total = reviews.length;
      const avg = total > 0 ? (reviews.reduce((s, r) => s + r.so_sao, 0) / total).toFixed(1) : 0;
      const positive = total > 0 ? Math.round((reviews.filter(r => r.so_sao >= 4).length / total) * 100) : 0;
      const negative = total > 0 ? Math.round((reviews.filter(r => r.so_sao <= 2).length / total) * 100) : 0;
      document.getElementById('avg-rating').textContent = avg;
      document.getElementById('total-reviews').textContent = total;
      document.getElementById('positive-reviews').textContent = positive + '%';
      document.getElementById('negative-reviews').textContent = negative + '%';
    }
    function renderStars(rating) { var s = ''; for (var i = 1; i <= 5; i++) s += '<i class="fas fa-star ' + (i <= rating ? 'text-amber-400' : 'text-slate-200') + ' text-sm"></i>'; return s; }
    function formatCurrency(amount) { return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(parseFloat(amount) || 0); }
    function formatDate(d) { if (!d) return 'N/A'; return new Date(d).toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' }); }
    function getStatusBadge(s) { 
      var badges = { 
        pending: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-amber-50 to-yellow-50 text-amber-700 rounded-full text-xs font-semibold border border-amber-200"><i class="fas fa-clock text-[10px]"></i>Chờ xử lý</span>', 
        confirmed: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 rounded-full text-xs font-semibold border border-blue-200"><i class="fas fa-check text-[10px]"></i>Đã xác nhận</span>', 
        shipping: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-purple-50 to-violet-50 text-purple-700 rounded-full text-xs font-semibold border border-purple-200"><i class="fas fa-truck text-[10px]"></i>Đang giao</span>', 
        delivered: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-emerald-50 to-teal-50 text-emerald-700 rounded-full text-xs font-semibold border border-emerald-200"><i class="fas fa-box-open text-[10px]"></i>Đã giao</span>', 
        cancelled: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-rose-50 to-pink-50 text-rose-700 rounded-full text-xs font-semibold border border-rose-200"><i class="fas fa-times text-[10px]"></i>Đã hủy</span>' 
      }; 
      return badges[s] || badges.pending; 
    }
    function showToast(msg, type) { 
      type = type || 'success'; 
      var toast = document.getElementById('toast'); 
      document.getElementById('toast-message').textContent = msg; 
      var iconEl = document.getElementById('toast-icon');
      var iconWrapper = iconEl.parentElement;
      if (type === 'success') {
        iconEl.className = 'fas fa-check text-white';
        iconWrapper.className = 'w-10 h-10 rounded-full bg-gradient-to-r from-emerald-400 to-teal-400 flex items-center justify-center';
      } else {
        iconEl.className = 'fas fa-exclamation text-white';
        iconWrapper.className = 'w-10 h-10 rounded-full bg-gradient-to-r from-rose-400 to-pink-400 flex items-center justify-center';
      }
      toast.classList.remove('translate-y-20', 'opacity-0'); 
      toast.classList.add('translate-y-0', 'opacity-100'); 
      setTimeout(function() { hideToast(); }, 4000); 
    }
    function hideToast() {
      var toast = document.getElementById('toast');
      toast.classList.add('translate-y-20', 'opacity-0'); 
      toast.classList.remove('translate-y-0', 'opacity-100');
    }
    document.getElementById('order-search').addEventListener('input', function(e) { 
      var s = e.target.value.toLowerCase().trim(); 
      if (!s) { renderOrders(allOrders); return; }
      renderOrders(allOrders.filter(function(o) { 
        return (o.ten_nguoi_nhan && o.ten_nguoi_nhan.toLowerCase().indexOf(s) >= 0) || 
               String(o.ma_don).indexOf(s) >= 0 ||
               (o.so_dt && o.so_dt.indexOf(s) >= 0); 
      })); 
    });
    document.getElementById('order-status-filter').addEventListener('change', function(e) { 
      var s = e.target.value; 
      var searchVal = document.getElementById('order-search').value.toLowerCase().trim();
      var filtered = s ? allOrders.filter(function(o) { return o.trang_thai === s; }) : allOrders;
      if (searchVal) {
        filtered = filtered.filter(function(o) { 
          return (o.ten_nguoi_nhan && o.ten_nguoi_nhan.toLowerCase().indexOf(searchVal) >= 0) || 
                 String(o.ma_don).indexOf(searchVal) >= 0; 
        });
      }
      renderOrders(filtered); 
    });
    document.getElementById('product-search').addEventListener('input', function(e) { 
      var s = e.target.value.toLowerCase().trim(); 
      if (!s) { renderProducts(allProducts); return; }
      renderProducts(allProducts.filter(function(p) { 
        var name = (p.ten_sp || p.name || '').toLowerCase();
        var desc = (p.mo_ta || p.description || '').toLowerCase();
        var color = (p.mau_sac || '').toLowerCase();
        var storage = (p.bo_nho || p.storage || '').toString().toLowerCase();
        return name.indexOf(s) >= 0 || desc.indexOf(s) >= 0 || color.indexOf(s) >= 0 || storage.indexOf(s) >= 0; 
      })); 
    });
    document.getElementById('product-brand-filter').addEventListener('change', function(e) { 
      var b = e.target.value; 
      var searchVal = document.getElementById('product-search').value.toLowerCase().trim();
      var filtered = b ? allProducts.filter(function(p) { 
        // H? tr? c? ma_hang (number) v� brand (slug)
        if (p.ma_hang) return p.ma_hang == b;
        // N?u Không có ma_hang, so s�nh brand slug v?i Tên Hãng
        var brandData = allBrands.find(function(br) { return br.ma_hang == b; });
        return brandData && p.brand && p.brand.toLowerCase() === brandData.ten_hang.toLowerCase();
      }) : allProducts;
      if (searchVal) {
        filtered = filtered.filter(function(p) { 
          var name = (p.ten_sp || p.name || '').toLowerCase();
          var desc = (p.mo_ta || p.description || '').toLowerCase();
          return name.indexOf(searchVal) >= 0 || desc.indexOf(searchVal) >= 0; 
        });
      }
      renderProducts(filtered); 
    });
    document.getElementById('customer-search').addEventListener('input', function(e) { 
      var s = e.target.value.toLowerCase().trim(); 
      if (!s) { renderCustomers(allCustomers); return; }
      renderCustomers(allCustomers.filter(function(c) { 
        return (c.ho_ten && c.ho_ten.toLowerCase().indexOf(s) >= 0) || 
               (c.email && c.email.toLowerCase().indexOf(s) >= 0) ||
               (c.so_dt && c.so_dt.indexOf(s) >= 0); 
      })); 
    });
    document.getElementById('review-rating-filter').addEventListener('change', function(e) { 
      var r = e.target.value; 
      var searchVal = document.getElementById('review-search').value.toLowerCase().trim();
      var filtered = r ? allReviews.filter(function(rv) { return rv.so_sao === parseInt(r); }) : allReviews;
      if (searchVal) {
        filtered = filtered.filter(function(rv) { 
          return (rv.ho_ten && rv.ho_ten.toLowerCase().indexOf(searchVal) >= 0) || 
                 (rv.ten_sp && rv.ten_sp.toLowerCase().indexOf(searchVal) >= 0) ||
                 (rv.binh_luan && rv.binh_luan.toLowerCase().indexOf(searchVal) >= 0); 
        });
      }
      renderReviews(filtered); 
      updateReviewStats(filtered);
    });
    document.getElementById('review-search').addEventListener('input', function(e) { 
      var s = e.target.value.toLowerCase().trim(); 
      var ratingFilter = document.getElementById('review-rating-filter').value;
      var filtered = ratingFilter ? allReviews.filter(function(rv) { return rv.so_sao === parseInt(ratingFilter); }) : allReviews;
      if (s) {
        filtered = filtered.filter(function(rv) { 
          return (rv.ho_ten && rv.ho_ten.toLowerCase().indexOf(s) >= 0) || 
                 (rv.ten_sp && rv.ten_sp.toLowerCase().indexOf(s) >= 0) ||
                 (rv.binh_luan && rv.binh_luan.toLowerCase().indexOf(s) >= 0); 
        });
      }
      renderReviews(filtered);
      updateReviewStats(filtered);
    });
    let allNews = [], editingNewsId = null;
    var selectedNewsImageFile = null;
    
    // Preview Ảnh Tin tức khi ch?n file
    function previewNewsImage(input) {
      if (input.files && input.files[0]) {
        selectedNewsImageFile = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('news-preview-img').src = e.target.result;
          document.getElementById('news-preview-img').classList.remove('hidden');
          document.getElementById('news-image-placeholder').classList.add('hidden');
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    
    // Reset Ảnh preview Tin tức
    function resetNewsImagePreview() {
      selectedNewsImageFile = null;
      document.getElementById('news-preview-img').src = '';
      document.getElementById('news-preview-img').classList.add('hidden');
      document.getElementById('news-image-placeholder').classList.remove('hidden');
      document.getElementById('news-image-file').value = '';
    }
    
    async function loadNews() {
      try { const res = await fetch(API_URL + '/admin/news'); const data = await res.json(); allNews = data.data || data || []; renderNews(allNews); initNewsSectionCharts(allNews); }
      catch(e) { console.error('Error loading news:', e); allNews = [{ma_tintuc:1,tieu_de:'Khai truong showroom moi',noi_dung:'Chung toi vui mung thong bao khai truong showroom...',anh_dai_dien:'',ten_admin:'Admin',ngay_dang:new Date()}]; renderNews(allNews); initNewsSectionCharts(allNews); }
    }
    function renderNews(news) {
      const tbody = document.getElementById('news-table');
      if (!news.length) { tbody.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-slate-400">Không có tin tức</td></tr>'; return; }
      tbody.innerHTML = news.map(n => {
        const hasVideo = n.video_url ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700"><i class="fas fa-video mr-1"></i>Video</span>' : '';
        return '<tr class="border-b border-slate-50 hover:bg-slate-50 transition-colors"><td class="py-4 px-2">' + (n.anh_dai_dien ? '<img src="' + n.anh_dai_dien + '" class="w-16 h-16 object-cover rounded-xl">' : '<div class="w-16 h-16 bg-slate-200 rounded-xl flex items-center justify-center"><i class="fas fa-newspaper text-slate-400"></i></div>') + '</td><td class="py-4"><p class="font-medium max-w-md">' + n.tieu_de + hasVideo + '</p><p class="text-xs text-slate-500 mt-1">' + truncateText(n.noi_dung, 80) + '</p></td><td class="py-4 text-slate-600">' + (n.ten_admin || 'N/A') + '</td><td class="py-4 text-slate-500">' + formatDate(n.ngay_dang) + '</td><td class="py-4 space-x-2"><button onclick="viewNews(' + n.ma_tintuc + ')" class="text-violet-600 hover:text-violet-800 p-1" title="Xem chi tiết"><i class="fas fa-eye"></i></button><button onclick="editNews(' + n.ma_tintuc + ')" class="text-blue-600 hover:text-blue-800 p-1" title="Chỉnh sửa"><i class="fas fa-edit"></i></button><button onclick="deleteNews(' + n.ma_tintuc + ')" class="text-red-600 hover:text-red-800 p-1" title="Xóa"><i class="fas fa-trash"></i></button></td></tr>';
      }).join('');
    }
    function openNewsModal(newsId) {
      editingNewsId = newsId || null;
      const modal = document.getElementById('news-modal');
      const form = document.getElementById('news-form');
      form.reset();
      resetNewsImagePreview();
      document.getElementById('news-video').value = '';
      
      if (newsId) {
        const news = allNews.find(n => n.ma_tintuc === newsId);
        if (news) {
          document.getElementById('news-modal-title').textContent = 'Chỉnh sửa tin tức';
          document.getElementById('news-id').value = news.ma_tintuc;
          document.getElementById('news-title').value = news.tieu_de;
          document.getElementById('news-content').value = news.noi_dung;
          document.getElementById('news-image').value = news.anh_dai_dien || '';
          document.getElementById('news-video').value = news.video_url || '';
          
          // Hiển thị ảnh đại diện nếu có
          if (news.anh_dai_dien) {
            document.getElementById('news-preview-img').src = news.anh_dai_dien;
            document.getElementById('news-preview-img').classList.remove('hidden');
            document.getElementById('news-image-placeholder').classList.add('hidden');
          }
        }
      } else {
        document.getElementById('news-modal-title').textContent = 'Thêm Tin tức mới';
      }
      modal.classList.remove('hidden');
    }
    function closeNewsModal() {
      document.getElementById('news-modal').classList.add('hidden');
      editingNewsId = null;
      resetNewsImagePreview();
    }
    function editNews(id) { openNewsModal(id); }
    async function deleteNews(id) {
      if (!confirm('Bạn có chắc chắn muốn xóa tin tức này?')) return;
      try {
        const res = await fetch(API_URL + '/admin/news/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) { showToast('Xóa tin tức thành công'); loadNews(); }
        else { showToast('Lỗi: ' + data.message, 'error'); }
      } catch(e) { console.error('Error deleting news:', e); showToast('Lỗi xóa tin tức', 'error'); }
    }
    document.getElementById('news-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      let imageUrl = document.getElementById('news-image').value || null;
      
      // N?u c� file Ảnh du?c ch?n, upload tru?c
      if (selectedNewsImageFile) {
        try {
          const formData = new FormData();
          formData.append('image', selectedNewsImageFile);
          
          const uploadRes = await fetch(API_URL + '/admin/upload', {
            method: 'POST',
            body: formData
          });
          const uploadData = await uploadRes.json();
          
          if (uploadData.success && uploadData.url) {
            imageUrl = uploadData.url;
          } else {
            // Fallback: D�ng data URL
            imageUrl = document.getElementById('news-preview-img').src;
          }
        } catch(uploadErr) {
          console.log('Upload failed, using data URL');
          imageUrl = document.getElementById('news-preview-img').src;
        }
      }
      
      const newsData = {
        tieu_de: document.getElementById('news-title').value,
        noi_dung: document.getElementById('news-content').value,
        anh_dai_dien: imageUrl,
        video_url: document.getElementById('news-video').value || null,
        ma_admin: 1
      };
      try {
        const url = editingNewsId ? API_URL + '/admin/news/' + editingNewsId : API_URL + '/admin/news';
        const method = editingNewsId ? 'PUT' : 'POST';
        const res = await fetch(url, { method: method, headers: {'Content-Type':'application/json'}, body: JSON.stringify(newsData) });
        const data = await res.json();
        if (data.success) {
          showToast(editingNewsId ? 'Cập nhật tin tức thành công' : 'Thêm tin tức thành công');
          closeNewsModal();
          loadNews();
        } else { showToast('Lỗi: ' + data.message, 'error'); }
      } catch(e) { console.error('Error saving news:', e); showToast('Lỗi lưu tin tức', 'error'); }
    });
    document.getElementById('news-search').addEventListener('input', function(e) {
      var s = e.target.value.toLowerCase().trim();
      if (!s) { renderNews(allNews); return; }
      renderNews(allNews.filter(function(n) { 
        return (n.tieu_de && n.tieu_de.toLowerCase().indexOf(s) >= 0) || 
               (n.noi_dung && n.noi_dung.toLowerCase().indexOf(s) >= 0) ||
               (n.ten_admin && n.ten_admin.toLowerCase().indexOf(s) >= 0); 
      }));
    });
    
    // Chuy?n đãi URL video th�nh embed URL
    function getVideoEmbedUrl(url) {
      if (!url) return null;
      
      // YouTube
      const youtubeMatch = url.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
      if (youtubeMatch) {
        return 'https://www.youtube.com/embed/' + youtubeMatch[1];
      }
      
      // Vimeo
      const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
      if (vimeoMatch) {
        return 'https://player.vimeo.com/video/' + vimeoMatch[1];
      }
      
      // N?u l� link video tr?c ti?p
      if (url.match(/\.(mp4|webm|ogg)$/i)) {
        return url;
      }
      
      return url;
    }
    
    function viewNews(id) {
      const news = allNews.find(n => n.ma_tintuc === id);
      if (news) {
        let html = '';
        
        // Ảnh đại diện
        if (news.anh_dai_dien) {
          html += '<div class="mb-6"><img src="' + news.anh_dai_dien + '" class="w-full h-64 object-cover rounded-2xl shadow-lg" alt="Ảnh Tin tức"></div>';
        }
        
        // Tiêu đề
        html += '<h2 class="text-2xl font-bold text-dark-800 mb-3">' + news.tieu_de + '</h2>';
        
        // tháng tin meta
        html += '<div class="flex flex-wrap items-center gap-4 mb-6 text-sm text-slate-500">';
        html += '<span><i class="fas fa-user mr-1 text-primary-500"></i>' + (news.ten_admin || 'Admin') + '</span>';
        html += '<span><i class="fas fa-calendar mr-1 text-primary-500"></i>' + formatDate(news.ngay_dang) + '</span>';
        if (news.video_url) {
          html += '<span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-700 font-medium"><i class="fas fa-video mr-1"></i>C� video d�nh k�m</span>';
        }
        html += '</div>';
        
        // Video (n?u c�)
        if (news.video_url) {
          const embedUrl = getVideoEmbedUrl(news.video_url);
          html += '<div class="mb-6">';
          html += '<h4 class="text-sm font-semibold text-dark-700 mb-3 flex items-center gap-2"><i class="fas fa-video text-blue-500"></i>Video</h4>';
          
          if (news.video_url.match(/\.(mp4|webm|ogg)$/i)) {
            // Video file tr?c ti?p
            html += '<video controls class="w-full rounded-xl shadow-lg" style="max-height: 400px;">';
            html += '<source src="' + embedUrl + '" type="video/mp4">';
            html += 'Tr�nh duy?t của bạn không hỗ trợ video.</video>';
          } else {
            // YouTube/Vimeo embed
            html += '<div class="relative w-full" style="padding-top: 56.25%;">';
            html += '<iframe src="' + embedUrl + '" class="absolute inset-0 w-full h-full rounded-xl shadow-lg" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
            html += '</div>';
          }
          html += '</div>';
        }
        
        // Nội dung
        html += '<div class="prose max-w-none">';
        html += '<h4 class="text-sm font-semibold text-dark-700 mb-3 flex items-center gap-2"><i class="fas fa-file-alt text-primary-500"></i>Nội dung</h4>';
        html += '<div class="bg-slate-50 rounded-xl p-4 text-dark-600 leading-relaxed whitespace-pre-wrap">' + (news.noi_dung || 'Không có Nội dung') + '</div>';
        html += '</div>';
        
        document.getElementById('news-detail-content').innerHTML = html;
        document.getElementById('news-detail-modal').classList.remove('hidden');
      }
    }
    
    function closeNewsDetailModal() {
      document.getElementById('news-detail-modal').classList.add('hidden');
      document.getElementById('news-detail-content').innerHTML = '';
    }
    
    function viewReview(id) {
      const review = allReviews.find(r => r.ma_dg === id);
      if (review) {
        alert('CHI TIẾT ĐÁNH GIÁ\n\nKhách hàng: ' + (review.ho_ten || 'N/A') + '\nSản phẩm: ' + (review.ten_sp || 'N/A') + '\nSố sao: ' + review.so_sao + '/5\nNgày đánh giá: ' + formatDate(review.ngay_danh_gia) + '\n\nBình luận:\n' + (review.binh_luan || 'Không có bình luận'));
      }
    }
    async function deleteReview(id) {
      if (!confirm('Bạn có chắc chắn muốn xóa đánh giá này?')) return;
      try {
        const res = await fetch(API_URL + '/admin/reviews/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
          showToast('Xóa đánh giá thành công');
          loadReviews();
        } else {
          showToast(data.message || 'Lỗi xóa đánh giá', 'error');
        }
      } catch(e) {
        console.error('Error deleting review:', e);
        showToast('Lỗi xóa đánh giá', 'error');
      }
    }
    function truncateText(text, maxLength) {
      if (!text) return '';
      return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }

    // =============== quản lý Hãng sản xuất ===============
    let allBrandsData = [], allCountries = [], editingBrandId = null;
    
    async function loadBrandsSection() {
      await loadCountries();
      try {
        const res = await fetch(API_URL + '/admin/brands');
        const data = await res.json();
        allBrandsData = data.data || data || [];
        renderBrandsTable(allBrandsData);
        // C?p nh?t thống kê
        updateBrandsStats();
        // Kh?i t?o Biểu đồ
        initBrandsSectionCharts(allBrandsData);
      } catch(e) {
        console.error('Error loading brands:', e);
        showToast('lỗi t?i danh s�ch Hãng', 'error');
      }
    }
    
    function updateBrandsStats() {
      const totalBrands = allBrandsData.length;
      const brandsWithProducts = allBrandsData.filter(b => b.so_san_pham > 0).length;
      const brandsEmpty = allBrandsData.filter(b => !b.so_san_pham || b.so_san_pham === 0).length;
      const uniqueCountries = [...new Set(allBrandsData.map(b => b.ma_quoc_gia).filter(Boolean))].length;
      
      document.getElementById('total-brands').textContent = totalBrands;
      document.getElementById('brands-with-products').textContent = brandsWithProducts;
      document.getElementById('brands-empty').textContent = brandsEmpty;
      document.getElementById('total-countries').textContent = uniqueCountries;
    }
    
    async function loadCountries() {
      try {
        const res = await fetch(API_URL + '/admin/countries');
        const data = await res.json();
        allCountries = data.data || data || [];
        const select = document.getElementById('brand-country');
        if (select) {
          select.innerHTML = '<option value="">Chọn quốc gia</option>' + 
            allCountries.map(c => '<option value="' + c.ma_quoc_gia + '">' + c.ten_quoc_gia + '</option>').join('');
        }
      } catch(e) {
        console.error('Error loading countries:', e);
      }
    }
    
    function renderBrandsTable(brands) {
      const tbody = document.getElementById('brands-table');
      if (!tbody) return;
      if (!brands.length) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-dark-400"><div class="flex flex-col items-center gap-2"><div class="w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mb-2"><i class="fas fa-inbox text-slate-300 text-2xl"></i></div><span>Chưa có hãng sản xuất nào</span></div></td></tr>';
        return;
      }
      tbody.innerHTML = brands.map((b, index) => `
        <tr class="table-row-hover hover:bg-slate-50 transition-colors">
          <td class="px-6 py-4"><span class="w-8 h-8 inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-primary-100 to-violet-100 text-primary-700 font-bold text-sm">${index + 1}</span></td>
          <td class="px-6 py-4 font-semibold text-dark-800">${b.ten_hang}</td>
          <td class="px-6 py-4 text-dark-500">${b.ten_quoc_gia || '<span class="text-slate-400">Chưa cập nhật</span>'}</td>
          <td class="px-6 py-4 text-center"><span class="inline-flex items-center justify-center min-w-[32px] h-8 bg-gradient-to-r from-violet-100 to-purple-100 text-violet-700 px-3 rounded-full text-sm font-bold">${b.so_san_pham || 0}</span></td>
          <td class="px-6 py-4">
            <div class="flex items-center gap-2">
              <button onclick="openBrandModal(${b.ma_hang})" class="w-9 h-9 rounded-xl bg-primary-50 hover:bg-primary-100 text-primary-600 flex items-center justify-center transition-colors" title="Sửa"><i class="fas fa-edit text-sm"></i></button>
              <button onclick="deleteBrand(${b.ma_hang})" class="w-9 h-9 rounded-xl bg-rose-50 hover:bg-rose-100 text-rose-500 flex items-center justify-center transition-colors" title="Xóa"><i class="fas fa-trash text-sm"></i></button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    function openBrandModal(brandId = null) {
      editingBrandId = brandId;
      const modal = document.getElementById('brand-modal');
      const title = document.getElementById('brand-modal-title');
      const form = document.getElementById('brand-form');
      
      if (brandId) {
        const brand = allBrandsData.find(b => b.ma_hang === brandId);
        if (brand) {
          title.textContent = 'Sửa Hãng sản xuất';
          document.getElementById('brand-id').value = brand.ma_hang;
          document.getElementById('brand-name').value = brand.ten_hang;
          document.getElementById('brand-country').value = brand.ma_quoc_gia || '';
        }
      } else {
        title.textContent = 'Thêm Hãng mới';
        form.reset();
        document.getElementById('brand-id').value = '';
      }
      modal.classList.remove('hidden');
    }
    
    function closeBrandModal() {
      document.getElementById('brand-modal').classList.add('hidden');
      editingBrandId = null;
    }
    
    async function saveBrand(event) {
      event.preventDefault();
      const brandId = document.getElementById('brand-id').value;
      const ten_hang = document.getElementById('brand-name').value.trim();
      const ma_quoc_gia = document.getElementById('brand-country').value;
      
      if (!ten_hang) {
        showToast('Vui lòng nhập tên hãng', 'error');
        return;
      }
      
      try {
        let res;
        if (editingBrandId) {
          res = await fetch(API_URL + '/admin/brands/' + editingBrandId, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ten_hang, ma_quoc_gia: ma_quoc_gia || null })
          });
        } else {
          res = await fetch(API_URL + '/admin/brands', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ ten_hang, ma_quoc_gia: ma_quoc_gia || null })
          });
        }
        
        const data = await res.json();
        if (data.success) {
          showToast(editingBrandId ? 'Cập nhật hãng thành công' : 'Thêm hãng thành công');
          closeBrandModal();
          loadBrandsSection();
          loadBrands(); // Reload brands for product dropdown
        } else {
          showToast(data.message || 'Lỗi lưu hãng', 'error');
        }
      } catch(e) {
        console.error('Error saving brand:', e);
        showToast('Lỗi lưu hãng sản xuất', 'error');
      }
    }
    
    async function deleteBrand(brandId) {
      if (!confirm('Bạn có chắc chắn muốn xóa hãng này?')) return;
      
      try {
        const res = await fetch(API_URL + '/admin/brands/' + brandId, { method: 'DELETE' });
        const data = await res.json();
        
        if (data.success) {
          showToast('Xóa hãng thành công');
          loadBrandsSection();
          loadBrands();
        } else {
          showToast(data.message || 'Không thể xóa hãng này', 'error');
        }
      } catch(e) {
        console.error('Error deleting brand:', e);
        showToast('Lỗi xóa hãng', 'error');
      }
    }
    
    // Event listener cho tìm kiếm hãng
    document.getElementById('brand-search')?.addEventListener('input', function() {
      const keyword = this.value.toLowerCase();
      const filtered = allBrandsData.filter(b => 
        b.ten_hang.toLowerCase().includes(keyword) || 
        (b.ten_quoc_gia && b.ten_quoc_gia.toLowerCase().includes(keyword))
      );
      renderBrandsTable(filtered);
    });
    
    // Event listener cho form Hãng
    document.getElementById('brand-form')?.addEventListener('submit', saveBrand);

    // ==================== CONTACTS FUNCTIONS ====================
    async function loadContactStats() {
      try {
        const res = await fetch(API_URL + '/admin/contacts/stats');
        const data = await res.json();
        if (data.success) {
          document.getElementById('new-contact-count').textContent = data.data.new_count || 0;
        }
      } catch(e) { console.error('Error loading contact stats:', e); }
    }

    async function loadContacts() {
      try {
        const res = await fetch(API_URL + '/admin/contacts');
        const data = await res.json();
        allContacts = data.data || [];
        renderContacts(allContacts);
        updateContactStats(allContacts);
      } catch(e) {
        console.error('Error loading contacts:', e);
        allContacts = [];
        renderContacts(allContacts);
      }
    }

    function updateContactStats(contacts) {
      const total = contacts.length;
      const newCount = contacts.filter(c => c.trang_thai === 'new').length;
      const readCount = contacts.filter(c => c.trang_thai === 'read').length;
      const repliedCount = contacts.filter(c => c.trang_thai === 'replied').length;
      document.getElementById('contact-total').textContent = total;
      document.getElementById('contact-new').textContent = newCount;
      document.getElementById('contact-read').textContent = readCount;
      document.getElementById('contact-replied').textContent = repliedCount;
      document.getElementById('new-contact-count').textContent = newCount;
    }

    function renderContacts(contacts) {
      const tbody = document.getElementById('contacts-table');
      if (!contacts.length) {
        tbody.innerHTML = '<tr><td colspan="7" class="py-8 text-center text-slate-400">Không có liên hệ nào</td></tr>';
        return;
      }
      tbody.innerHTML = contacts.map(c => '<tr class="border-b border-slate-50 ' + (c.trang_thai === 'new' ? 'bg-emerald-50/50' : '') + '"><td class="py-4 font-medium">' + (c.ho_ten || 'N/A') + '</td><td class="py-4 text-slate-500">' + (c.email || 'N/A') + '</td><td class="py-4 text-slate-500">' + (c.so_dien_thoai || 'N/A') + '</td><td class="py-4 text-slate-600 max-w-[150px] truncate">' + (c.tieu_de || 'Không có chủ đề') + '</td><td class="py-4">' + getContactStatusBadge(c.trang_thai) + '</td><td class="py-4 text-slate-500">' + formatDate(c.ngay_gui) + '</td><td class="py-4"><div class="flex gap-2"><button onclick="viewContact(' + c.ma_lien_he + ')" class="text-blue-600 hover:text-blue-700" title="Xem chi tiết"><i class="fas fa-eye"></i></button><button onclick="updateContactStatus(' + c.ma_lien_he + ', \'replied\')" class="text-emerald-600 hover:text-emerald-700" title="Đã phản hồi"><i class="fas fa-check"></i></button><button onclick="deleteContact(' + c.ma_lien_he + ')" class="text-red-600 hover:text-red-700" title="Xóa"><i class="fas fa-trash"></i></button></div></td></tr>').join('');
    }

    function getContactStatusBadge(status) {
      var badges = {
        'new': '<span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded-lg text-xs font-medium">Mới</span>',
        'read': '<span class="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-medium">Đã xem</span>',
        'replied': '<span class="px-2 py-1 bg-violet-100 text-violet-700 rounded-lg text-xs font-medium">Đã phản hồi</span>'
      };
      return badges[status] || badges['new'];
    }

    async function viewContact(id) {
      try {
        const res = await fetch(API_URL + '/admin/contacts/' + id);
        const data = await res.json();
        if (data.success) {
          const c = data.data;
          
          // Lấy lịch sử phản hồi
          let responsesHtml = '';
          try {
            const resResponses = await fetch(API_URL + '/admin/contacts/' + id + '/responses');
            const respData = await resResponses.json();
            if (respData.success && respData.data.length > 0) {
              responsesHtml = '<div class="border-t border-slate-100 pt-4 mt-4"><p class="text-sm text-slate-500 mb-3"><i class="fas fa-history mr-1"></i> Lịch sử phản hồi</p><div class="space-y-3 max-h-40 overflow-y-auto">';
              respData.data.forEach(function(r) {
                responsesHtml += '<div class="bg-violet-50 rounded-lg p-3"><div class="flex items-center gap-2 mb-1"><span class="text-xs font-medium text-violet-700">' + (r.admin_name || 'Admin') + '</span><span class="text-xs text-slate-400">' + formatDate(r.ngay_phan_hoi) + '</span></div><p class="text-sm text-slate-700">' + r.noi_dung_phan_hoi + '</p></div>';
              });
              responsesHtml += '</div></div>';
            }
          } catch(e) { console.log('No responses yet'); }
          
          const modal = document.createElement('div');
          modal.id = 'contact-modal';
          modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
          modal.innerHTML = `
            <div class="absolute inset-0 bg-black/50" onclick="closeContactModal()"></div>
            <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
              <div class="sticky top-0 bg-white border-b border-slate-100 px-6 py-4 flex items-center justify-between z-10">
                <h3 class="text-lg font-bold text-slate-800">Chi tiết liên hệ</h3>
                <button onclick="closeContactModal()" class="text-slate-400 hover:text-slate-600">
                  <i class="fas fa-times text-xl"></i>
                </button>
              </div>
              <div class="p-6 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <p class="text-sm text-slate-500">Họ tên</p>
                    <p class="font-medium">${c.ho_ten}</p>
                  </div>
                  <div>
                    <p class="text-sm text-slate-500">Email</p>
                    <p class="font-medium">${c.email}</p>
                  </div>
                  <div>
                    <p class="text-sm text-slate-500">Số điện thoại</p>
                    <p class="font-medium">${c.so_dien_thoai || 'N/A'}</p>
                  </div>
                  <div>
                    <p class="text-sm text-slate-500">Ngày gửi</p>
                    <p class="font-medium">${formatDate(c.ngay_gui)}</p>
                  </div>
                </div>
                <div>
                  <p class="text-sm text-slate-500">Chủ đề</p>
                  <p class="font-medium">${c.tieu_de || 'Không có chủ đề'}</p>
                </div>
                <div>
                  <p class="text-sm text-slate-500 mb-2">Nội dung</p>
                  <div class="bg-slate-50 rounded-xl p-4 text-slate-700">${c.noi_dung}</div>
                </div>
                
                ${responsesHtml}
                
                <!-- Form phản hồi -->
                <div class="border-t border-slate-100 pt-4">
                  <p class="text-sm text-slate-500 mb-2"><i class="fas fa-reply mr-1"></i> Phản hồi cho khách hàng</p>
                  <textarea id="response-content-${c.ma_lien_he}" rows="3" class="w-full border border-slate-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent" placeholder="Nhập nội dung phản hồi..."></textarea>
                </div>
                
                <div class="flex gap-3 pt-4">
                  <button onclick="closeContactModal()" class="flex-1 border border-slate-200 text-slate-600 py-3 rounded-xl font-medium hover:bg-slate-50">Đóng</button>
                  <button onclick="sendContactResponse(${c.ma_lien_he})" class="flex-1 bg-violet-600 hover:bg-violet-700 text-white py-3 rounded-xl font-medium text-center">
                    <i class="fas fa-paper-plane mr-2"></i>Phản hồi
                  </button>
                </div>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
          loadContacts();
        }
      } catch(e) {
        console.error('Error viewing contact:', e);
        showToast('Lỗi tải chi tiết liên hệ', 'error');
      }
    }

    // Gửi phản hồi liên hệ
    async function sendContactResponse(contactId) {
      const content = document.getElementById('response-content-' + contactId)?.value?.trim();
      if (!content) {
        showToast('Vui lòng nhập nội dung phản hồi', 'error');
        return;
      }
      
      try {
        // Lấy thông tin admin đang đăng nhập
        const adminInfo = JSON.parse(localStorage.getItem('adminInfo') || '{}');
        
        const res = await fetch(API_URL + '/admin/contacts/' + contactId + '/response', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            noi_dung_phan_hoi: content,
            ma_admin: adminInfo.ma_admin || null
          })
        });
        
        const data = await res.json();
        if (data.success) {
          showToast('Phản hồi đã được gửi thành công! Thông báo sẽ được gửi đến người dùng.');
          closeContactModal();
          loadContacts();
        } else {
          showToast(data.message || 'Lỗi gửi phản hồi', 'error');
        }
      } catch(e) {
        console.error('Error sending response:', e);
        showToast('Lỗi gửi phản hồi', 'error');
      }
    }

    function closeContactModal() {
      const modal = document.getElementById('contact-modal');
      if (modal) modal.remove();
    }

    async function updateContactStatus(id, status) {
      try {
        const res = await fetch(API_URL + '/admin/contacts/' + id + '/status', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: status })
        });
        const data = await res.json();
        if (data.success) {
          showToast('Cập nhật trạng thái thành công');
          loadContacts();
        } else {
          showToast(data.message || 'Lỗi cập nhật', 'error');
        }
      } catch(e) {
        console.error('Error updating contact status:', e);
        showToast('Lỗi cập nhật trạng thái', 'error');
      }
    }

    async function deleteContact(id) {
      if (!confirm('Bạn có chắc muốn xóa liên hệ này?')) return;
      try {
        const res = await fetch(API_URL + '/admin/contacts/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
          showToast('Đã xóa liên hệ');
          loadContacts();
        } else {
          showToast(data.message || 'Lỗi xóa liên hệ', 'error');
        }
      } catch(e) {
        console.error('Error deleting contact:', e);
        showToast('Lỗi xóa liên hệ', 'error');
      }
    }

    document.getElementById('contact-search')?.addEventListener('input', function(e) {
      const s = e.target.value.toLowerCase();
      renderContacts(allContacts.filter(function(c) {
        return (c.ho_ten && c.ho_ten.toLowerCase().includes(s)) || 
               (c.email && c.email.toLowerCase().includes(s)) ||
               (c.tieu_de && c.tieu_de.toLowerCase().includes(s));
      }));
    });

    document.getElementById('contact-status-filter')?.addEventListener('change', function(e) {
      const status = e.target.value;
      renderContacts(status ? allContacts.filter(function(c) { return c.trang_thai === status; }) : allContacts);
    });

    // ==================== QUẢN LÝ KHUYẾN MÃI ====================
    let allPromotions = [], editingPromotionId = null;

    async function loadPromotions() {
      try {
        // Load thống kê
        const statsRes = await fetch(API_URL + '/admin/promotions/stats');
        const statsData = await statsRes.json();
        if (statsData.success) {
          document.getElementById('promo-total').textContent = statsData.data.total || 0;
          document.getElementById('promo-active').textContent = statsData.data.active || 0;
          document.getElementById('promo-upcoming').textContent = statsData.data.upcoming || 0;
          document.getElementById('promo-expired').textContent = statsData.data.expired || 0;
          document.getElementById('promo-used').textContent = statsData.data.total_used || 0;
          document.getElementById('active-promo-count').textContent = statsData.data.active || 0;
        }
        
        // Load danh sách
        const res = await fetch(API_URL + '/admin/promotions');
        const data = await res.json();
        allPromotions = data.data || [];
        renderPromotions(allPromotions);
      } catch(e) {
        console.error('Error loading promotions:', e);
        allPromotions = [];
        renderPromotions([]);
      }
    }

    function renderPromotions(promotions) {
      const tbody = document.getElementById('promotions-table');
      if (!promotions.length) {
        tbody.innerHTML = '<tr><td colspan="8" class="px-6 py-12 text-center text-dark-400"><div class="flex flex-col items-center gap-2"><div class="w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mb-2"><i class="fas fa-tags text-slate-300 text-2xl"></i></div><span>Chưa có khuyến mãi nào</span></div></td></tr>';
        return;
      }
      
      tbody.innerHTML = promotions.map(p => {
        const statusBadge = getPromotionStatusBadge(p.trang_thai_hien_tai || p.trang_thai);
        const discountText = p.loai === 'percent' ? p.gia_tri + '%' : formatCurrency(p.gia_tri);
        const typeText = { voucher: 'Voucher', free_ship: 'Free Ship', flash_sale: 'Flash Sale', discount_product: 'Giảm SP' }[p.loai_km] || 'Voucher';
        
        return `
          <tr class="table-row-hover hover:bg-slate-50 transition-colors">
            <td class="px-6 py-4">
              <div class="flex items-center gap-2">
                <span class="font-bold text-primary-600 bg-primary-50 px-3 py-1 rounded-lg">${p.code}</span>
              </div>
            </td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded-lg text-xs font-medium ${p.loai_km === 'free_ship' ? 'bg-emerald-100 text-emerald-700' : 'bg-violet-100 text-violet-700'}">${typeText}</span>
            </td>
            <td class="px-6 py-4 font-bold text-rose-600">${discountText}</td>
            <td class="px-6 py-4 text-sm text-dark-500">
              ${p.dieu_kien_toi_thieu > 0 ? 'Từ ' + formatCurrency(p.dieu_kien_toi_thieu) : 'Không giới hạn'}
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center gap-2">
                <span class="font-semibold">${p.so_luong_da_dung || 0}</span>
                <span class="text-dark-400">/</span>
                <span class="text-dark-500">${p.so_luong}</span>
              </div>
              <div class="w-full bg-slate-200 rounded-full h-1.5 mt-1">
                <div class="bg-gradient-to-r from-primary-500 to-violet-500 h-1.5 rounded-full" style="width: ${Math.min(100, ((p.so_luong_da_dung || 0) / p.so_luong) * 100)}%"></div>
              </div>
            </td>
            <td class="px-6 py-4 text-sm">
              <div class="text-dark-600">${formatDate(p.ngay_bat_dau)}</div>
              <div class="text-dark-400">→ ${formatDate(p.ngay_ket_thuc)}</div>
            </td>
            <td class="px-6 py-4">${statusBadge}</td>
            <td class="px-6 py-4">
              <div class="flex items-center gap-2">
                <button onclick="editPromotion(${p.ma_km})" class="w-9 h-9 rounded-xl bg-primary-50 hover:bg-primary-100 text-primary-600 flex items-center justify-center transition-colors" title="Sửa">
                  <i class="fas fa-edit text-sm"></i>
                </button>
                <button onclick="togglePromotionStatus(${p.ma_km}, '${p.trang_thai}')" class="w-9 h-9 rounded-xl ${p.trang_thai === 'active' ? 'bg-amber-50 hover:bg-amber-100 text-amber-600' : 'bg-emerald-50 hover:bg-emerald-100 text-emerald-600'} flex items-center justify-center transition-colors" title="${p.trang_thai === 'active' ? 'Tạm dừng' : 'Kích hoạt'}">
                  <i class="fas ${p.trang_thai === 'active' ? 'fa-pause' : 'fa-play'} text-sm"></i>
                </button>
                <button onclick="deletePromotion(${p.ma_km})" class="w-9 h-9 rounded-xl bg-rose-50 hover:bg-rose-100 text-rose-500 flex items-center justify-center transition-colors" title="Xóa">
                  <i class="fas fa-trash text-sm"></i>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function getPromotionStatusBadge(status) {
      const badges = {
        active: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-emerald-50 to-teal-50 text-emerald-700 rounded-full text-xs font-semibold border border-emerald-200"><i class="fas fa-check-circle text-[10px]"></i>Hoạt động</span>',
        inactive: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-slate-50 to-gray-50 text-slate-600 rounded-full text-xs font-semibold border border-slate-200"><i class="fas fa-pause-circle text-[10px]"></i>Tạm dừng</span>',
        expired: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-rose-50 to-pink-50 text-rose-700 rounded-full text-xs font-semibold border border-rose-200"><i class="fas fa-times-circle text-[10px]"></i>Hết hạn</span>',
        upcoming: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-amber-50 to-yellow-50 text-amber-700 rounded-full text-xs font-semibold border border-amber-200"><i class="fas fa-clock text-[10px]"></i>Sắp diễn ra</span>',
        sold_out: '<span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-purple-50 to-violet-50 text-purple-700 rounded-full text-xs font-semibold border border-purple-200"><i class="fas fa-ticket text-[10px]"></i>Hết lượt</span>'
      };
      return badges[status] || badges.inactive;
    }

    function openPromotionModal(promotionId = null) {
      editingPromotionId = promotionId;
      const modal = document.getElementById('promotion-modal');
      const form = document.getElementById('promotion-form');
      form.reset();
      
      // Helper function để format ngày local
      const formatLocalDateTime = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${year}-${month}-${day}T${hours}:${minutes}`;
      };
      
      // Set default dates (local time)
      const now = new Date();
      const endDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days later
      document.getElementById('promotion-start').value = formatLocalDateTime(now);
      document.getElementById('promotion-end').value = formatLocalDateTime(endDate);
      
      if (promotionId) {
        const promo = allPromotions.find(p => p.ma_km === promotionId);
        if (promo) {
          document.getElementById('promotion-modal-title').textContent = 'Chỉnh sửa khuyến mãi';
          document.getElementById('promotion-submit-text').textContent = 'Cập nhật';
          document.getElementById('promotion-id').value = promo.ma_km;
          document.getElementById('promotion-code').value = promo.code;
          document.getElementById('promotion-type').value = promo.loai_km || 'voucher';
          document.getElementById('promotion-discount-type').value = promo.loai || 'percent';
          document.getElementById('promotion-value').value = promo.gia_tri;
          document.getElementById('promotion-desc').value = promo.mo_ta || '';
          document.getElementById('promotion-min').value = promo.dieu_kien_toi_thieu || 0;
          document.getElementById('promotion-max').value = promo.dieu_kien_toi_da || '';
          document.getElementById('promotion-quantity').value = promo.so_luong || 100;
          document.getElementById('promotion-status').value = promo.trang_thai || 'active';
          // Format ngày từ database
          const startDt = new Date(promo.ngay_bat_dau);
          const endDt = new Date(promo.ngay_ket_thuc);
          document.getElementById('promotion-start').value = formatLocalDateTime(startDt);
          document.getElementById('promotion-end').value = formatLocalDateTime(endDt);
        }
      } else {
        document.getElementById('promotion-modal-title').textContent = 'Thêm khuyến mãi mới';
        document.getElementById('promotion-submit-text').textContent = 'Lưu khuyến mãi';
      }
      
      modal.classList.remove('hidden');
    }

    function closePromotionModal() {
      document.getElementById('promotion-modal').classList.add('hidden');
      editingPromotionId = null;
    }

    function editPromotion(id) {
      openPromotionModal(id);
    }

    async function togglePromotionStatus(id, currentStatus) {
      const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
      try {
        const res = await fetch(API_URL + '/admin/promotions/' + id + '/status', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ trang_thai: newStatus })
        });
        const data = await res.json();
        if (data.success) {
          showToast(newStatus === 'active' ? 'Đã kích hoạt khuyến mãi' : 'Đã tạm dừng khuyến mãi');
          loadPromotions();
        } else {
          showToast(data.message || 'Lỗi cập nhật', 'error');
        }
      } catch(e) {
        console.error('Error toggling promotion status:', e);
        showToast('Lỗi cập nhật trạng thái', 'error');
      }
    }

    async function deletePromotion(id) {
      if (!confirm('Bạn có chắc chắn muốn xóa khuyến mãi này?')) return;
      
      try {
        const res = await fetch(API_URL + '/admin/promotions/' + id, { method: 'DELETE' });
        const data = await res.json();
        if (data.success) {
          showToast('Xóa khuyến mãi thành công');
          loadPromotions();
        } else {
          showToast(data.message || 'Lỗi xóa khuyến mãi', 'error');
        }
      } catch(e) {
        console.error('Error deleting promotion:', e);
        showToast('Lỗi xóa khuyến mãi', 'error');
      }
    }

    // Đồng bộ số lượng đã dùng từ đơn hàng
    async function syncPromotionUsage() {
      if (!confirm('Đồng bộ số lượng đã dùng từ các đơn hàng?\nThao tác này sẽ cập nhật lại số lượng đã dùng cho tất cả mã khuyến mãi.')) return;
      
      try {
        showToast('Đang đồng bộ...', 'info');
        const res = await fetch(API_URL + '/admin/promotions/sync-usage', { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          showToast('Đồng bộ thành công! Đã cập nhật số lượng đã dùng.');
          loadPromotions();
        } else {
          showToast(data.message || 'Lỗi đồng bộ', 'error');
        }
      } catch(e) {
        console.error('Error syncing promotion usage:', e);
        showToast('Lỗi đồng bộ số lượng', 'error');
      }
    }

    document.getElementById('promotion-form')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const promoData = {
        code: document.getElementById('promotion-code').value.trim().toUpperCase(),
        loai_km: document.getElementById('promotion-type').value,
        loai: document.getElementById('promotion-discount-type').value,
        gia_tri: parseFloat(document.getElementById('promotion-value').value),
        mo_ta: document.getElementById('promotion-desc').value.trim(),
        dieu_kien_toi_thieu: parseFloat(document.getElementById('promotion-min').value) || 0,
        dieu_kien_toi_da: document.getElementById('promotion-max').value ? parseFloat(document.getElementById('promotion-max').value) : null,
        so_luong: parseInt(document.getElementById('promotion-quantity').value) || 100,
        trang_thai: document.getElementById('promotion-status').value,
        ngay_bat_dau: document.getElementById('promotion-start').value,
        ngay_ket_thuc: document.getElementById('promotion-end').value
      };
      
      try {
        let res;
        if (editingPromotionId) {
          res = await fetch(API_URL + '/admin/promotions/' + editingPromotionId, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(promoData)
          });
        } else {
          res = await fetch(API_URL + '/admin/promotions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(promoData)
          });
        }
        
        const data = await res.json();
        if (data.success) {
          showToast(editingPromotionId ? 'Cập nhật khuyến mãi thành công' : 'Thêm khuyến mãi thành công');
          closePromotionModal();
          loadPromotions();
        } else {
          showToast(data.message || 'Lỗi lưu khuyến mãi', 'error');
        }
      } catch(e) {
        console.error('Error saving promotion:', e);
        showToast('Lỗi lưu khuyến mãi', 'error');
      }
    });

    // Tìm kiếm khuyến mãi
    document.getElementById('promo-search')?.addEventListener('input', function(e) {
      const s = e.target.value.toLowerCase().trim();
      if (!s) { renderPromotions(allPromotions); return; }
      renderPromotions(allPromotions.filter(p => 
        p.code.toLowerCase().includes(s) || 
        (p.mo_ta && p.mo_ta.toLowerCase().includes(s))
      ));
    });

    // Lọc theo trạng thái
    document.getElementById('promo-status-filter')?.addEventListener('change', function(e) {
      const status = e.target.value;
      if (!status) { renderPromotions(allPromotions); return; }
      renderPromotions(allPromotions.filter(p => p.trang_thai === status || p.trang_thai_hien_tai === status));
    });

    // Load promotions stats on page load
    loadPromotions();

    // ==================== QUẢN LÝ THÔNG BÁO ====================
    let allCustomersForNotif = [];

    async function loadNotificationSection() {
      // Load danh sách khách hàng cho dropdown
      try {
        const res = await fetch(API_URL + '/admin/customers');
        const data = await res.json();
        if (data.success) {
          allCustomersForNotif = data.data || [];
          const select = document.getElementById('notif-customer');
          if (select) {
            select.innerHTML = '<option value="">-- Chọn khách hàng --</option>' + 
              allCustomersForNotif.map(c => `<option value="${c.ma_kh}">${c.ho_ten} (${c.email})</option>`).join('');
          }
        }
      } catch(e) {
        console.error('Error loading customers for notification:', e);
      }
      
      // Load lịch sử thông báo
      loadNotificationHistory();
    }

    async function loadNotificationHistory() {
      try {
        const res = await fetch(API_URL + '/admin/notifications?limit=50');
        const data = await res.json();
        renderNotificationHistory(data.data || []);
      } catch(e) {
        console.error('Error loading notification history:', e);
        renderNotificationHistory([]);
      }
    }

    function renderNotificationHistory(notifications) {
      const tbody = document.getElementById('notification-history-table');
      if (!notifications.length) {
        tbody.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-slate-400">Chưa có thông báo nào được gửi</td></tr>';
        return;
      }
      
      const typeLabels = {
        'system': '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">Hệ thống</span>',
        'promotion': '<span class="px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs">Khuyến mãi</span>',
        'order_update': '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">Đơn hàng</span>',
        'contact_response': '<span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs">Phản hồi</span>'
      };
      
      tbody.innerHTML = notifications.map(n => `
        <tr class="border-b border-slate-100 hover:bg-slate-50">
          <td class="py-3">
            <p class="font-medium text-slate-800 truncate max-w-xs">${n.tieu_de}</p>
            <p class="text-xs text-slate-400 truncate max-w-xs">${n.noi_dung?.substring(0, 50)}...</p>
          </td>
          <td class="py-3">${typeLabels[n.loai] || typeLabels['system']}</td>
          <td class="py-3 text-sm text-slate-600">${n.ho_ten || 'Tất cả'}</td>
          <td class="py-3 text-sm text-slate-500">${new Date(n.ngay_tao).toLocaleString('vi-VN')}</td>
          <td class="py-3">
            ${n.da_doc ? '<span class="text-green-600 text-xs"><i class="fas fa-check-circle"></i> Đã đọc</span>' : '<span class="text-slate-400 text-xs"><i class="far fa-clock"></i> Chưa đọc</span>'}
          </td>
        </tr>
      `).join('');
    }

    // Toggle hiển thị dropdown chọn khách hàng
    document.getElementById('notif-target')?.addEventListener('change', function(e) {
      const singleSelect = document.getElementById('single-customer-select');
      if (e.target.value === 'single') {
        singleSelect.classList.remove('hidden');
      } else {
        singleSelect.classList.add('hidden');
      }
    });

    // Xử lý gửi thông báo
    document.getElementById('notification-form')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const target = document.getElementById('notif-target').value;
      const customerId = document.getElementById('notif-customer').value;
      const type = document.getElementById('notif-type').value;
      const title = document.getElementById('notif-title').value.trim();
      const content = document.getElementById('notif-content').value.trim();
      const link = document.getElementById('notif-link').value.trim();
      
      if (!title || !content) {
        showToast('Vui lòng nhập tiêu đề và nội dung', 'error');
        return;
      }
      
      if (target === 'single' && !customerId) {
        showToast('Vui lòng chọn khách hàng', 'error');
        return;
      }
      
      try {
        let res;
        if (target === 'all') {
          // Gửi cho tất cả
          res = await fetch(API_URL + '/notifications/broadcast', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ tieu_de: title, noi_dung: content, loai: type, lien_ket: link || null })
          });
        } else {
          // Gửi cho 1 người
          res = await fetch(API_URL + '/notifications', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ma_kh: customerId, tieu_de: title, noi_dung: content, loai: type, lien_ket: link || null })
          });
        }
        
        const data = await res.json();
        if (data.success) {
          showToast(data.message || 'Gửi thông báo thành công!');
          // Reset form
          document.getElementById('notif-title').value = '';
          document.getElementById('notif-content').value = '';
          document.getElementById('notif-link').value = '';
          loadNotificationHistory();
        } else {
          showToast(data.message || 'Lỗi gửi thông báo', 'error');
        }
      } catch(e) {
        console.error('Error sending notification:', e);
        showToast('Lỗi gửi thông báo', 'error');
      }
    });

    // Mẫu thông báo nhanh
    function useNotifTemplate(template) {
      const templates = {
        'promo': {
          type: 'promotion',
          title: '🎁 Ưu đãi đặc biệt dành cho bạn!',
          content: 'Chào bạn! QuangHưng Mobile có chương trình khuyến mãi cực hấp dẫn. Giảm giá lên đến 20% cho tất cả sản phẩm. Nhanh tay đặt hàng ngay hôm nay!',
          link: 'promotions.html'
        },
        'flash': {
          type: 'promotion',
          title: '⚡ Flash Sale - Chỉ trong hôm nay!',
          content: 'FLASH SALE cực sốc! Giảm đến 50% cho các sản phẩm iPhone, Samsung. Số lượng có hạn, nhanh tay kẻo lỡ!',
          link: 'products.html'
        },
        'newproduct': {
          type: 'system',
          title: '📱 Sản phẩm mới đã có mặt!',
          content: 'Tin vui! QuangHưng Mobile vừa nhập về các sản phẩm mới nhất với giá cực tốt. Ghé thăm cửa hàng để trải nghiệm ngay!',
          link: 'products.html'
        },
        'thanks': {
          type: 'system',
          title: '❤️ Cảm ơn bạn đã tin tưởng QuangHưng Mobile!',
          content: 'Cảm ơn bạn đã mua sắm tại QuangHưng Mobile. Chúng tôi rất vui được phục vụ bạn. Đừng quên đánh giá sản phẩm để nhận ưu đãi cho lần mua tiếp theo nhé!',
          link: ''
        }
      };
      
      const t = templates[template];
      if (t) {
        document.getElementById('notif-type').value = t.type;
        document.getElementById('notif-title').value = t.title;
        document.getElementById('notif-content').value = t.content;
        document.getElementById('notif-link').value = t.link;
        showToast('Đã áp dụng mẫu thông báo');
      }
    }
  </script>
  <!-- Main JS - Page Loader -->
  <script src="main.js"></script>
</body>
</html>

